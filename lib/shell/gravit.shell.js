!function(a){function b(){}GObject.inherit(b,GObject),b.prototype.getId=function(){throw new Error("Not Supported")},b.prototype.getTitle=function(){throw new Error("Not Supported")},b.prototype.getCategory=function(){return null},b.prototype.getGroup=function(){return null},b.prototype.getShortcut=function(){return null},b.prototype.isEnabled=function(){return!0},b.prototype.isCheckable=function(){return!1},b.prototype.isChecked=function(){return!1},b.prototype.isAvailable=function(){return!0},b.prototype.execute=function(){throw new Error("Not Supported")},b.prototype.toString=function(){return"[Object GAction]"},a.GAction=b}(this),function(a){function b(){}b.parseSize=function(a){var b=null,c=null,d=a.split("@"),e=function(a){if("?"===a)return null;var b=GUtil.parseNumber(a);if("number"!=typeof b)return null;var c=a.substr(b.toString().length);return c&&c.length>0&&(c=c.trim().toLowerCase(),"x"===c)?b:GLength.parseLength(a)},b=null,c=null;switch(d[0].charAt(d[0].length-1)){case"w":case"W":b=e(d[0].substr(0,d[0].length-1));break;case"h":case"H":c=e(d[0].substr(0,d[0].length-1));break;default:b=e(d[0]),d.length>1&&(c=e(d[1]))}return{width:b,height:c}},b.prototype.isStandalone=function(){throw new Error("Not Supported.")},b.prototype.getName=function(){throw new Error("Not Supported.")},b.prototype.getExtensions=function(){throw new Error("Not Supported.")},b.prototype.exportPart=function(){throw new Error("Not Supported.")},a.GExporter=b}(this),function(a){function b(){}b.prototype.init=function(){},a.GModule=b}(this),function(a){function b(){}GObject.inherit(b,GEventTarget),b.UpdateEvent=function(){},GObject.inherit(b.UpdateEvent,GEvent),b.UpdateEvent.prototype.toString=function(){return"[Object GView.UpdateEvent]"},b.UPDATE_EVENT=new b.UpdateEvent,b.DocumentState=function(a){this.document=a},b.DocumentState.prototype.document=null,b.DocumentState.prototype.activate=function(){},b.DocumentState.prototype.deactivate=function(){},b.DocumentState.prototype.init=function(){},b.DocumentState.prototype.release=function(){},b.prototype._documentStates=null,b.prototype.getId=function(){throw new Error("Not Supported")},b.prototype.getTitle=function(){throw new Error("Not Supported")},b.prototype.isEnabled=function(){return!0},b.prototype._createDocumentState=function(){return null},b.prototype._activateDocumentState=function(){},b.prototype._deactivateDocumentState=function(){},b.prototype._documentEvent=function(a){switch(a.type){case GApplication.DocumentEvent.Type.Added:var c=this._createDocumentState(a.document);c&&(c.init(),this._documentStates||(this._documentStates=[]),this._documentStates.push(c),this.trigger(b.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Removed:var c=this._findDocumentState(a.document);c&&(c.release(),this._documentStates.splice(this._documentStates.indexOf(c),1),0===this._documentStates.length&&(this._documentStates=null),this.trigger(b.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Activated:var c=this._findDocumentState(a.document);c&&(c.activate(),this._activateDocumentState(c),this.trigger(b.UPDATE_EVENT));break;case GApplication.DocumentEvent.Type.Deactivated:var c=this._findDocumentState(a.document);c&&(c.deactivate(),this._deactivateDocumentState(c),this.trigger(b.UPDATE_EVENT))}},b.prototype._findDocumentState=function(a){if(!this._documentStates)return null;for(var b=0;b<this._documentStates.length;++b)if(this._documentStates[b].document===a)return this._documentStates[b]},b.prototype.toString=function(){return"[Object GView]"},a.GView=b}(this),function(a){function b(){GView.call(this)}GObject.inherit(b,GView),b.prototype.isAutoSize=function(){return!1},b.prototype.getGroup=function(){return null},b.prototype.init=function(){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},b.prototype.toString=function(){return"[Object GPalette]"},a.GPalette=b}(this),function(a){function b(){GView.call(this)}GObject.inherit(b,GView),b.prototype.getTitle=function(){return null},b.prototype.init=function(){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},b.prototype.activate=function(){},b.prototype.deactivate=function(){},b.prototype.toString=function(){return"[Object GPanel]"},a.GPanel=b}(this),function(a){function b(){}b.prototype.init=function(){throw new Error("Not Supported.")},b.prototype.update=function(){throw new Error("Not Supported.")},b.prototype.toString=function(){return"[Object GProperties]"},a.GProperties=b}(this),function(a){function b(){GView.call(this)}GObject.inherit(b,GView),b.prototype.getIcon=function(){return null},b.prototype.init=function(){gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this)},b.prototype.activate=function(){},b.prototype.deactivate=function(){},b.prototype.toString=function(){return"[Object GSidebar]"},a.GSidebar=b}(this),function(a){function b(){}b.prototype.isAvailable=function(){throw new Error("Not supported.")},b.prototype.isSaving=function(){throw new Error("Not supported.")},b.prototype.isPrompting=function(){throw new Error("Not supported.")},b.prototype.isDirectory=function(){throw new Error("Not supported.")},b.prototype.getProtocol=function(){throw new Error("Not supported.")},b.prototype.getExtensions=function(){throw new Error("Not Supported.")},b.prototype.getName=function(){throw new Error("Not supported.")},b.prototype.openResourcePrompt=function(){throw new Error("Not supported.")},b.prototype.saveResourcePrompt=function(){throw new Error("Not supported.")},b.prototype.openDirectoryPrompt=function(){throw new Error("Not supported.")},b.prototype.saveDirectoryPrompt=function(){throw new Error("Not supported.")},b.prototype.load=function(){throw new Error("Not Supported.")},b.prototype.save=function(){throw new Error("Not Supported.")},b.prototype.releaseUrl=function(){},b.prototype.resolveUrl=function(){throw new Error("Not Supported.")},a.GStorage=b}(this),function(a){function b(a){this._htmlElement=a}b.prototype._htmlElement=null,b.prototype.init=function(){$("<div></div>").addClass("windows").appendTo(this._htmlElement),$("<div></div>").addClass("view").append(this._createZoom()).appendTo(this._htmlElement),this._updateZoomFromWindow(),gApp.addEventListener(GApplication.DocumentEvent,this._documentEvent,this),gApp.getWindows().addEventListener(GWindows.WindowEvent,this._windowEvent,this),this._updateView()},b.prototype.relayout=function(){this._htmlElement.find(".view").css("padding-right",gApp.isPartVisible(GApplication.Part.Palettes)?gApp.getPart(GApplication.Part.Palettes).outerWidth().toString()+"px":"")},b.prototype._documentEvent=function(a){if(a.type===GApplication.DocumentEvent.Type.UrlUpdated)for(var b=a.document.getWindows(),c=0;c<b.length;++c)this._htmlElement.find(".windows > .tab").each(function(a,d){var e=$(d);return e.data("window")===b[c]?(e.find(".title").text(b[c].getTitle()),!1):void 0})},b.prototype._windowEvent=function(a){switch(a.type){case GWindows.WindowEvent.Type.Added:this._addWindowTab(a.window);break;case GWindows.WindowEvent.Type.Removed:this._removeWindowTab(a.window);break;case GWindows.WindowEvent.Type.Activated:a.window.getView().addEventListener(GSceneWidget.TransformEvent,this._updateZoomFromWindow,this),this._updateView(),this._updateZoomFromWindow(),this._updateActiveWindowTab();break;case GWindows.WindowEvent.Type.Deactivated:a.window.getView().removeEventListener(GSceneWidget.TransformEvent,this._updateZoomFromWindow,this),this._updateView(),this._updateZoomFromWindow(),this._updateActiveWindowTab()}},b.prototype._addWindowTab=function(a){$("<div></div>").data("window",a).addClass("tab").append($("<span></span>").addClass("title").text(a.getTitle())).append($("<span></span>").addClass("close fa fa-times").on("click",function(a){a.stopPropagation(),gApp.getWindows().closeWindow($(this).parents(".tab").data("window"))})).on("click",function(){gApp.getWindows().activateWindow($(this).data("window"))}).appendTo(this._htmlElement.find(".windows"))},b.prototype._removeWindowTab=function(a){this._htmlElement.find(".windows > .tab").each(function(b,c){var d=$(c);return d.data("window")===a?(d.remove(),!1):void 0})},b.prototype._updateActiveWindowTab=function(){this._htmlElement.find(".windows > .tab").each(function(a,b){var c=$(b);c.toggleClass("g-active",c.data("window")===gApp.getWindows().getActiveWindow())})},b.prototype._createZoom=function(){for(var a=[6,12,25,50,66,100,150,200,300,400,800,1600,3200,6400],b=$("<select></select>").addClass("zoom").append($("<option></option>")).on("change",function(){var a=gApp.getWindows().getActiveWindow().getView(),b=a.getScene(),c=null;if(b.getProperty("singlePage")){var d=b.getActivePage().getGeometryBBox();d&&!d.isEmpty()&&(c=d.getSide(GRect.Side.CENTER))}c||(c=a.getViewTransform().mapPoint(new GPoint(a.getWidth()/2,a.getHeight()/2))),a.zoomAt(c,parseInt($(this).val())/100)}),c=0;c<a.length;++c)$("<option></option>").text(a[c].toString()+"%").attr("value",a[c]).appendTo(b);return b},b.prototype._updateZoomFromWindow=function(){var a=this._htmlElement.find(".view > .zoom"),b=gApp.getWindows().getActiveWindow();if(a.find("*").prop("disabled",!b),b){var c=GMath.round(100*b.getView().getZoom(),!1,0);a.find("option:first-child").text(c.toString()+"%").attr("value",c),a.val(c)}},b.prototype._updateView=function(){this._htmlElement.find(".view").css("visibility",gApp.getWindows().getActiveWindow()?"":"hidden")},a.GHeader=b}(this),function(a){function b(a){this._htmlElement=a,this._palettesInfo=[],this._groupsInfo=[],this._collapseIcon=$('<span class="fa fa-stack collapse-icon"><span class="fa fa-stack-1x fa-angle-up"></span><span class="fa fa-stack-1x fa-angle-down"></span></span>')}b.prototype._htmlElement=null,b.prototype._palettesInfo=null,b.prototype._groupsInfo=null,b.prototype._collapseIcon=null,b.prototype.groupPalettes=function(a){for(var b=0;b<a.length;++b)this._detachPaletteFromGroup(a[b].getId());for(var c=this._addGroupInfo(),b=0;b<a.length;++b)this._attachPaletteToGroup(c,a[b].getId())},b.prototype.isPaletteActive=function(a){var b=this._getGroupInfoForPalette(a);return b?b.activePalette===a&&b.visible&&b.expanded:!1},b.prototype.setPaletteActive=function(a){var b=this._getGroupInfoForPalette(a);if(b&&(b.activePalette!==a||!b.visible||!b.expanded)){var c=this._getPaletteInfo(a);b.activePalette=a,b.container.find(".palette-group-tabs > button").each(function(b,c){var d=$(c);d.attr("data-palette-id")===a?d.addClass("g-active"):d.removeClass("g-active")}.bind(this)),b.container.find(".palette-group-panels > div").each(function(b,c){var d=$(c);d.attr("data-palette-id")===a?d.css("display",""):d.css("display","none")});var d=b.container.find(".palette-group-controls");d.children().detach(),d.append(c.controls),b.expanded?this._layoutPalettes():this._setGroupExpanded(b,!0)}},b.prototype.isPaletteEnabled=function(a){var b=this._getPaletteInfo(a);return b?0==b.panel.find(".panel-disabled-overlay").length:!1},b.prototype.setPaletteEnabled=function(a,b){var c=this._getPaletteInfo(a);if(c)if(b)c.panel.find(".g-disabled-overlay").remove(),c.panel.removeClass("g-disabled");else{var d=c.panel.find(".g-disabled-overlay");0===d.length&&(d=$("<div></div>").addClass("g-disabled-overlay").appendTo(c.panel)),c.panel.addClass("g-disabled")}},b.prototype.init=function(){for(var a=[],b=null,c=null,d=0;d<gravit.palettes.length;++d){var e=gravit.palettes[d];this._addPaletteInfo(e);var f=e.getGroup();f||(f=e.getId()),b&&b===f||(c&&a.push(c),c=[],b=f),c.push(e)}c&&a.push(c);for(var d=0;d<a.length;++d){this.groupPalettes(a[d]),this.setPaletteActive(a[d][0].getId(),!0);for(var g=0;g<a[d].length;++g){var e=a[d][g];this.setPaletteEnabled(e.getId(),e.isEnabled())}}},b.prototype.relayout=function(){this._layoutPalettes()},b.prototype._addPaletteInfo=function(a){var b=$("<div></div>").attr("data-palette-id",a.getId()).addClass("palette-panel").addClass("palette-"+a.getId()).css("display","none"),c=$("<div></div>");a.init(b,c);var d={palette:a,panel:b,controls:c};return this._palettesInfo.push(d),a.addEventListener(GView.UpdateEvent,function(){this.setPaletteEnabled(a.getId(),a.isEnabled())}.bind(this)),d},b.prototype._getPaletteInfo=function(a){for(var b=0;b<this._palettesInfo.length;++b)if(this._palettesInfo[b].palette.getId()===a)return this._palettesInfo[b];return null},b.prototype._detachPaletteFromGroup=function(a){var b=this._getGroupInfoForPalette(a),c=this._getPaletteInfo(a);b&&c&&(b.container.find('.palette-group-tabs > button[data-palette-id="'+a+'"]').remove(),b.container.find('.palette-group-panels > div[data-palette-id="'+a+'"]').detach(),b.palettes.slice(b.palettes.indexOf(a)))},b.prototype._attachPaletteToGroup=function(a,b){var c=this._getPaletteInfo(b);if(c){var d=a.container.find(".palette-group-tabs"),e=a.container.find(".palette-group-panels");d.append($("<button></button>").attr("data-palette-id",c.palette.getId()).text(ifLocale.get(c.palette.getTitle())).on("click",function(){this.isPaletteActive(c.palette.getId())?this._setGroupExpanded(a,!a.expanded):this.setPaletteActive(c.palette.getId(),!0)}.bind(this)).prepend(this._collapseIcon.clone())),e.append(c.panel),a.palettes.push(b)}},b.prototype._addGroupInfo=function(){var a={expanded:!0,visible:!0,activePalette:null,palettes:[]};return a.container=$("<div></div>").addClass("palette-group").append($("<div></div>").addClass("palette-group-header").append($("<div></div>").addClass("palette-group-tabs")).append($("<div></div>").addClass("palette-group-controls"))).append($("<div></div>").addClass("palette-group-panels")).appendTo(this._htmlElement),this._groupsInfo.push(a),a},b.prototype._getGroupInfoForPalette=function(a){for(var b=0;b<this._groupsInfo.length;++b)if(this._groupsInfo[b].palettes.indexOf(a)>=0)return this._groupsInfo[b];return null},b.prototype._setGroupExpanded=function(a,b){if(b!==a.expanded){if(a.expanded=b,a.expanded)a.container.css("height",""),a.container.removeClass("collapsed-palette");else{var c=a.container.find(".palette-group-header");a.container.height(c.outerHeight()),a.container.addClass("collapsed-palette")}this._layoutPalettes()}},b.prototype._layoutPalettes=function(){for(var a=this._htmlElement.height(),b=0,c=[],d=0;d<this._groupsInfo.length;++d){var e=this._groupsInfo[d];if(a-=e.container.find(".palette-group-header").outerHeight(),e.expanded&&e.activePalette)for(var f=0;f<this._palettesInfo.length;++f){var g=this._palettesInfo[f];g.palette.getId()===e.activePalette&&(g.palette.isAutoSize()?b++:a-=g.panel.outerHeight(),c.push(g))}}var h=0;a>0&&b>0&&(a-=3*(c.length+1),h=a/b);for(var d=0;d<c.length;++d){var g=c[d];h>0&&g.palette.isAutoSize()?(g.savedHeight=g.panel.css("height"),g.panel.css("height",h.toString()+"px")):g.panel.css("height",g.savedHeight)}},a.GPalettes=b}(this),function(a){function b(a){this._htmlElement=a,this._collapseIcon=$('<span class="fa fa-stack collapse-icon"><span class="fa fa-stack-1x fa-angle-up"></span><span class="fa fa-stack-1x fa-angle-down"></span></span>')}b.CollapseMode={None:"none",Half:"half",Full:"full"},b.prototype._htmlElement=null,GPalettes.prototype._collapseIcon=null,b.prototype._panels=null,b.prototype._activePanel=null,b.prototype._collapseMode=null,b.prototype.getCollapseMode=function(){return this._collapseMode},b.prototype.setCollapseMode=function(a){a!==this._collapseMode&&(this._collapseMode&&this._htmlElement.removeClass("collapse-"+this._collapseMode),this._collapseMode=a,this._collapseMode&&this._htmlElement.addClass("collapse-"+this._collapseMode))},b.prototype.toggleCollapseMode=function(){switch(this._collapseMode){case b.CollapseMode.Full:this.setCollapseMode(b.CollapseMode.None);break;case b.CollapseMode.Half:this.setCollapseMode(b.CollapseMode.Full);break;case b.CollapseMode.None:this.setCollapseMode(b.CollapseMode.Half)}},b.prototype.getActivePanel=function(){return this._activePanel},b.prototype.setActivePanel=function(a){if(a===this._activePanel)this.toggleCollapseMode();else{for(var b=0;b<this._panels.length;++b){var c=this._panels[b],d=c.panel.getId();d===a?(c.container.css("display",""),c.tab.addClass("g-active"),c.panel.activate()):(c.container.css("display","none"),c.tab.removeClass("g-active"),d===this._activePanel&&c.panel.deactivate())}this._activePanel=a}},b.prototype.setPanelEnabled=function(a,b){var c=this._getPanelInfo(a);if(c)if(b)c.container.find(".g-disabled-overlay").remove(),c.container.removeClass("g-disabled");else{var d=c.container.find(".g-disabled-overlay");0===d.length&&(d=$("<div></div>").addClass("g-disabled-overlay").appendTo(c.container)),c.container.addClass("g-disabled")}},b.prototype.init=function(){this._panels=[];var a=$("<div></div>").addClass("panels-tabs").appendTo(this._htmlElement),c=$("<div></div>").addClass("panels-frame").appendTo(this._htmlElement),d=function(b){var d=$("<button></button>").addClass("panel-tab").attr("data-panel-id",b.getId()).text(ifLocale.get(b.getTitle())).on("click",function(a){this.setActivePanel($(a.target).closest("button").attr("data-panel-id"))}.bind(this)).prepend(this._collapseIcon.clone()).appendTo(a),e=$("<div></div>").addClass("panel-container panel-"+b.getId()).css("display","none").appendTo(c);b.init(e),this.setPanelEnabled(b.getId(),b.isEnabled()),this._panels.push({tab:d,container:e,panel:b}),b.addEventListener(GView.UpdateEvent,function(){this.setPanelEnabled(b.getId(),b.isEnabled())}.bind(this))}.bind(this);if(gravit.panels)for(var e=0;e<gravit.panels.length;++e){var f=gravit.panels[e];d(f),this._activePanel||this.setActivePanel(f.getId())}this.setCollapseMode(b.CollapseMode.None)},b.prototype.relayout=function(){},b.prototype._getPanelInfo=function(a){for(var b=0;b<this._panels.length;++b){var c=this._panels[b].panel;if(c.getId()===a)return this._panels[b]}},a.GPanels=b}(this),function(a){function b(a){this._htmlElement=a}b.prototype._htmlElement=null,b.prototype._sidebars=null,b.prototype._activeSidebar=null,b.prototype.getActiveSidebar=function(){return this._activeSidebar},b.prototype.setActiveSidebar=function(a){if(a!==this._activeSidebar){for(var b=0;b<this._sidebars.length;++b){var c=this._sidebars[b],d=c.sidebar.getId();d===a?(c.container.css("display",""),c.sidebar.activate()):(c.container.css("display","none"),d===this._activeSidebar&&c.sidebar.deactivate())}this._activeSidebar=a}},b.prototype.setSidebarEnabled=function(a,b){var c=this._getSidebarInfo(a);if(c)if(b)c.container.find(".g-disabled-overlay").remove(),c.container.removeClass("g-disabled");else{var d=c.container.find(".g-disabled-overlay");0===d.length&&(d=$("<div></div>").addClass("g-disabled-overlay").appendTo(c.container)),c.container.addClass("g-disabled")}},b.prototype.init=function(){this._sidebars=[];var a=function(a){var b=$("<div></div>").addClass("sidebar-container sidebar-"+a.getId()).css("display","none").appendTo(this._htmlElement);a.init(b),this.setSidebarEnabled(a.getId(),a.isEnabled()),this._sidebars.push({container:b,sidebar:a}),a.addEventListener(GView.UpdateEvent,function(){this.setSidebarEnabled(a.getId(),a.isEnabled())}.bind(this))}.bind(this);if(gravit.sidebars)for(var b=0;b<gravit.sidebars.length;++b){var c=gravit.sidebars[b];a(c)}},b.prototype.relayout=function(){},b.prototype._getSidebarInfo=function(a){for(var b=0;b<this._sidebars.length;++b){var c=this._sidebars[b].sidebar;if(c.getId()===a)return this._sidebars[b]}},a.GSidebars=b}(this),function(a){function b(a){this._htmlElement=a,a.append($("<div></div>").addClass("section sidebars")).append($("<div></div>").addClass("section toolpanel"))}b.prototype._htmlElement=null,b.prototype._groupedTools=null,b.prototype.init=function(){if(gravit.sidebars&&gravit.sidebars.length>0)for(var a=this._htmlElement.find(".sidebars"),b=0;b<gravit.sidebars.length;++b){var c=gravit.sidebars[b];$("<button></button>").append($(c.getIcon())).attr("title",ifLocale.get(c.getTitle())).attr("data-sidebar-id",c.getId()).on("click",function(){var b=$(this),c=b.hasClass("g-active");a.find("button").each(function(a,b){$(b).removeClass("g-active")}),c?(gApp.getSidebars().setActiveSidebar(null),gApp.setPartVisible(GApplication.Part.Sidebars,!1)):(gApp.getSidebars().setActiveSidebar(b.attr("data-sidebar-id")),gApp.setPartVisible(GApplication.Part.Sidebars,!0),b.addClass("g-active"))}).appendTo(a)}var d=this._htmlElement.find(".toolpanel");this._groupedTools=[];for(var b=0;b<gravit.tools.length;++b){for(var e=gravit.tools[b],f=!1,g=0;g<this._groupedTools.length;++g)this._groupedTools[g].group===e.group&&(this._groupedTools[g].tools.push(e),f=!0);f||this._groupedTools.push({group:e.group,tools:[e]})}for(var h=null,b=0;b<this._groupedTools.length;++b){var i=this._groupedTools[b].group,j=this._groupedTools[b].tools,k=j[0],l=ifLocale.get(k.category);l!=h&&(null!==h&&$("<hr>").appendTo(d),h=l);{$("<button></button>").attr("data-group",i).appendTo(d)}j.length>1,this._updateGroupTool(k.instance)}gApp.getToolManager().addEventListener(GToolManager.ToolChangedEvent,this._toolChanged,this)},b.prototype.relayout=function(){},b.prototype._toolChanged=function(a){a.previousTool&&this._updateGroupTool(a.previousTool),a.newTool&&this._updateGroupTool(a.newTool)},b.prototype._updateGroupTool=function(a){for(var b=this._getToolInfo(a),c=[],d=0;d<this._groupedTools.length;++d)this._groupedTools[d].group===b.group&&(c=this._groupedTools[d].tools.slice());var e=this._htmlElement.find('.toolpanel button[data-group="'+b.group+'"]');e.empty().toggleClass("g-active",a==gApp.getToolManager().getActiveTool()).attr("title",this._getToolTitle(b)).append($(b.icon).attr("width","18px").attr("height","18px")).off("mousedown").on("mousedown",function(){if(gApp.getToolManager().activateTool(a),c.length>1){var b=setTimeout(function(){for(var a=$("<div></div>").gOverlay({releaseOnClose:!0}),b=function(b){$("<button></button>").addClass("toolbar-tool-button").append($("<span></span>").addClass("fa fa-check fa-fw").css("visibility",b.instance!==gApp.getToolManager().getActiveTool()?"hidden":"")).append($(b.icon).attr("width","18px").attr("height","18px")).append($("<span></span>").html("&nbsp;"+this._getToolTitle(b))).on("mouseenter",function(){$(this).addClass("g-hover")}).on("mouseleave",function(){$(this).removeClass("g-hover")}).on("mouseup",function(){gApp.getToolManager().activateTool(b.instance),a.gOverlay("close")}).on("click",function(){gApp.getToolManager().getActiveTool()!==b.instance&&(gApp.getToolManager().activateTool(b.instance),a.gOverlay("close"))}).appendTo(a)}.bind(this),d=0;d<c.length;++d)b(c[d]);a.gOverlay("open",e)}.bind(this),250);e.off("mouseup").on("mouseup",function(){clearTimeout(b),b=null})}}.bind(this)),c.length>1&&e.append($("<span></span>").addClass("fa fa-caret-down"))},b.prototype._getToolTitle=function(a){var b=ifLocale.get(a.title);if(a.keys&&a.keys.length>0){for(var c=0;c<a.keys.length;++c)b+=0==c?" (":", ",b+=a.keys[c];b+=")"}return b},b.prototype._getToolInfo=function(a){for(var b=0;b<gravit.tools.length;++b)if(gravit.tools[b].instance===a)return gravit.tools[b];return null},a.GToolbar=b}(this),function(a){function b(a){this._container=$("<div></div>"),this._document=a,this._view=new GEditorWidget(this._document.getEditor()),this._view.setViewMargin([b.VIEW_MARGIN,b.VIEW_MARGIN,b.VIEW_MARGIN,b.VIEW_MARGIN]),this._container.append(this._view._htmlElement),this._container.on("mousedown",function(){this._view.focus()}.bind(this));var c=this._createContextMenu();this._container.on("contextmenu",function(a){var b=gApp.getToolManager(),d=b.getActiveTool();return d&&d.catchesContextMenu()?void 0:(this._contextMenuClientPosition=new GPoint(a.clientX,a.clientY),c.open({x:a.pageX,y:a.pageY}),!0)}.bind(this))}GObject.inherit(b,GEventTarget),b.VIEW_MARGIN=10,b.prototype._container=null,b.prototype._document=null,b.prototype._view=null,b.prototype._contextMenuClientPosition=null,b.prototype.getDocument=function(){return this._document},b.prototype.getView=function(){return this._view},b.prototype.getTitle=function(){var a=this._document.getTitle(),b=this._document._windows.indexOf(this);return b>0&&(a+=":"+b.toString()),a},b.prototype.activate=function(){},b.prototype.deactivate=function(){this._document.getEditor().closeInlineEditor()},b.prototype.release=function(){this._view.release()},b.prototype._createContextMenu=function(){var a=new GMenu,b=new GMenuItem(GMenuItem.Type.Menu);return b.setCaption("Select"),b.addEventListener(GMenuItem.UpdateEvent,function(){b.getMenu().clearItems(),b.setEnabled(!1);var a=this._document.getScene().hitTest(this._contextMenuClientPosition,this._view.getWorldTransform(),function(){return!0}.bind(this),!0,-1,this._document.getScene().getProperty("pickDist"),!0);if(a&&a.length>0){b.setEnabled(!0);for(var c=0;c<a.length;++c){var d=this,e=a[c].element,f=e instanceof GBlock?e.getLabel():e.getNodeNameTranslated();b.getMenu().createAddItem((c+1).toString()+". "+f,function(){this.element.removeFlag(GNode.Flag.Highlighted),d._document.getEditor().updateSelection(ifPlatform.modifiers.shiftKey,[this.element])},function(){this.element.setFlag(GNode.Flag.Highlighted)},function(){this.element.removeFlag(GNode.Flag.Highlighted)}).element=e}}}.bind(this)),a.addItem(b),a},a.GWindow=b}(this),function(a){function b(a){this._htmlElement=a,this._windows=[]}GObject.inherit(b,GEventTarget),b.WindowEvent=function(a,b){this.type=a,this.window=b},GObject.inherit(b.WindowEvent,GEvent),b.WindowEvent.Type={Added:0,Removed:1,Deactivated:10,Activated:11},b.WindowEvent.prototype.type=null,b.WindowEvent.prototype.window=null,b.WindowEvent.prototype.toString=function(){return"[Object GWindows.WindowEvent]"},b.prototype._htmlElement=null,b.prototype._windows=null,b.prototype._activeWindow=null,b.prototype._viewOffset=null,b.prototype.getWindows=function(){return this._windows},b.prototype.getActiveWindow=function(){return this._activeWindow},b.prototype.activateWindow=function(a){if(a!=this._activeWindow){this._activeWindow&&(this._activeWindow.deactivate(),this._activeWindow.getDocument()._activeWindow=null,this._activeWindow._container.detach()),null===a?gApp.activateDocument(null,!0):(a&&this._activeWindow&&a.getDocument()!==this._activeWindow.getDocument()||!this._activeWindow)&&gApp.activateDocument(a.getDocument(),!0);var c=this._activeWindow;this._activeWindow=a,c&&this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Deactivated,c)),a&&(this._activeWindow.activate(),a.getDocument()._activeWindow=a,this._htmlElement.append(a._container),this._relayoutWindow(a),a.getView().focus(),this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Activated,a)))}},b.prototype.addWindow=function(a){var b=a instanceof GWindow?a.getDocument():a,c=this._addWindow(b);if(a instanceof GWindow){var d=a.getView();c.getView().transform(d.getScrollX(),d.getScrollY(),d.getZoom())}else c.getView().zoomActivePage();return c},b.prototype.closeWindow=function(a){var c=a.getDocument();if(a===this._activeWindow){var d=this._windows.indexOf(a);this.activateWindow(d>0?this._windows[d-1]:d+1<this._windows.length?this._windows[d+1]:null)}c._windows.splice(c._windows.indexOf(a),1),this._windows.splice(this._windows.indexOf(a),1),a._container.remove(),this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Removed,a)),a.release(),0===c._windows.length&&gApp.closeDocument(c)},b.prototype.init=function(){},b.prototype.relayout=function(a){this._viewOffset=a?a:this._viewOffset,this._activeWindow&&this._relayoutWindow(this._activeWindow)},b.prototype._relayoutWindow=function(a){var b=this._htmlElement.width(),c=this._htmlElement.height();a._container.width(b),a._container.height(c),a.getView().setViewOffset(this._viewOffset);var d=a.getView().getWidth(),e=a.getView().getHeight();a.getView().resize(b,c),null==d||null==e||d==b&&e==c||a.getView().scrollBy((d-b)/2,(e-c)/2)},b.prototype._addWindow=function(a){var c=new GWindow(a);return a._windows.push(c),this._windows.push(c),this.hasEventListeners(b.WindowEvent)&&this.trigger(new b.WindowEvent(b.WindowEvent.Type.Added,c)),this.activateWindow(c),c},a.GWindows=b}(this),function(a){function b(a,b){var l=a.L,m=a.a,n=a.b,o=b.L,p=b.a,q=b.b,r=1,s=1,t=1,u=e(f(m,2)+f(n,2)),v=e(f(p,2)+f(q,2)),w=(u+v)/2,x=.5*(1-e(f(w,7)/(f(w,7)+f(25,7)))),y=(1+x)*m,z=(1+x)*p,A=e(f(y,2)+f(n,2)),B=e(f(z,2)+f(q,2)),C=function(a,b){if(0==a&&0==b)return 0;var d=c(h(a,b));return d>=0?d:d+360},D=C(n,y),E=C(q,z),F=o-l,G=B-A,H=function(a,b,c,d){if(a*b==0)return 0;if(j(d-c)<=180)return d-c;if(d-c>180)return d-c-360;if(-180>d-c)return d-c+360;throw new Error},I=H(u,v,D,E),J=2*e(A*B)*i(d(I)/2),K=(l+o)/2,L=(A+B)/2,M=function(a,b,c,d){if(a*b==0)return c+d;if(j(c-d)<=180)return(c+d)/2;if(j(c-d)>180&&360>c+d)return(c+d+360)/2;if(j(c-d)>180&&c+d>=360)return(c+d-360)/2;throw new Error},N=M(u,v,D,E),O=1-.17*g(d(N-30))+.24*g(d(2*N))+.32*g(d(3*N+6))-.2*g(d(4*N-63)),P=30*k(-f((N-275)/25,2)),Q=e(f(L,7)/(f(L,7)+f(25,7))),R=1+.015*f(K-50,2)/e(20+f(K-50,2)),S=1+.045*L,T=1+.015*L*O,U=-2*Q*i(d(2*P)),V=e(f(F/(R*r),2)+f(G/(S*s),2)+f(J/(T*t),2)+U*(G/(S*s))*(J/(T*t)));return V}function c(a){return a*(180/l)}function d(a){return a*(l/180)}a.ciede2000=b;var e=Math.sqrt,f=Math.pow,g=Math.cos,h=Math.atan2,i=Math.sin,j=Math.abs,k=Math.exp,l=Math.PI}(this),function(a){a.image2Canvas=function(b,c){if("string"==typeof b&&"data:"!==b.substr(0,5)){var d=new Image;d.src=b,d.onload=function(){a.image2Canvas(d,c)}}else{var e=document.createElement("canvas");e.width=b.naturalWidth,e.height=b.naturalHeight;var f=e.getContext("2d");f.drawImage(b,0,0),c(e)}},a.image2Base64=function(b,c){a.image2Canvas(b,function(a){c(a.toDataURL("image/png"))})},a.image2ArrayBuffer=function(b,c){a.image2Canvas(b,function(a){a.toBlob(function(a){var b=new FileReader;b.onload=function(a){c(a.target.result)},b.readAsArrayBuffer(a)})})}}(this),function(a){a.expr[":"].editable=function(b){var c=a(b);if("true"===c.attr("contenteditable")||b.isContentEditable)return!0;if(c.is(":input")){var d=c.attr("type");return!d||""===d||"text"===d}return c.is("textArea")?!0:!1}}(jQuery);var gravit={modules:[],storages:[],exporters:[],actions:[],palettes:[],sidebars:[],panels:[],tools:[],properties:[]},gHost=null,gApp=null;$(document).ready(function(){if(!gHost)throw new Error("Host needs to be initialized, first.");if(!gApp)throw new Error("App needs to be initialized, first.");gApp.prepare(),gHost.init()}),$(window).load(function(){rangy.init(),gApp.init().always(function(){gHost.start(),gApp.start().always(function(){gApp.relayout()})})}),function(a){function b(){}GObject.inherit(b,GEventTarget),b.prototype.isDevelopment=function(){return!1},b.prototype.init=function(){},b.prototype.start=function(){},b.prototype.addMenu=function(){throw new Error("Not Supported.")},b.prototype.addMenuSeparator=function(){throw new Error("Not Supported.")},b.prototype.addMenuItem=function(){throw new Error("Not Supported.")},b.prototype.updateMenuItem=function(){throw new Error("Not Supported.")},b.prototype.removeMenuItem=function(){throw new Error("Not Supported.")},b.prototype.getClipboardMimeTypes=function(){throw new Error("Not Supported.")},b.prototype.getClipboardContent=function(){throw new Error("Not Supported.")},b.prototype.setClipboardContent=function(){throw new Error("Not Supported.")},a.GHost=b}(this),function(a){function b(){this._actions=[],this._toolManager=new GToolManager,this._documents=[],document.addEventListener("touchstart",this._touchHandler,!0),document.addEventListener("touchmove",this._touchHandler,!0),document.addEventListener("touchend",this._touchHandler,!0),document.addEventListener("touchcancel",this._touchHandler,!0),document.addEventListener("keydown",function(){document.activeElement&&$(document.activeElement).is(":button")&&(13==event.keyCode||32==event.keyCode)&&(event.preventDefault(),document.activeElement.blur());var a=this._windows.getActiveWindow();!a||document.activeElement&&$(document.activeElement).is(":editable")||a.getView().focus()}.bind(this),!1),document.addEventListener("contextmenu",function(a){return $(a.target).is(":editable")?(a.stopPropagation(),!0):(a.preventDefault(),!1)
},!0)}GObject.inherit(b,GEventTarget),b.CATEGORY_FILE=new GLocale.Key(b,"category.file"),b.CATEGORY_EDIT=new GLocale.Key(b,"category.edit"),b.CATEGORY_MODIFY=new GLocale.Key(b,"category.modify"),b.CATEGORY_MODIFY_ARRANGE=new GLocale.Key(b,"category.modify.arrange"),b.CATEGORY_MODIFY_ALIGN=new GLocale.Key(b,"category.modify.align"),b.CATEGORY_MODIFY_TRANSFORM=new GLocale.Key(b,"category.modify.transform"),b.CATEGORY_MODIFY_PATHS=new GLocale.Key(b,"category.modify.paths"),b.CATEGORY_MODIFY_PAGE=new GLocale.Key(b,"category.modify.page"),b.CATEGORY_MODIFY_LAYER=new GLocale.Key(b,"category.modify.layer"),b.CATEGORY_VIEW=new GLocale.Key(b,"category.view"),b.CATEGORY_VIEW_MAGNIFICATION=new GLocale.Key(b,"category.view.magnification"),b.CATEGORY_HELP=new GLocale.Key(b,"category.help"),b.TOOL_CATEGORY_SELECT=new GLocale.Key(b,"tool-category.select"),b.TOOL_CATEGORY_IMAGE=new GLocale.Key(b,"tool-category.image"),b.TOOL_CATEGORY_VECTOR=new GLocale.Key(b,"tool-category.vector"),b.TOOL_CATEGORY_OTHER=new GLocale.Key(b,"tool-category.other"),b.TOOL_CATEGORY_COLOR=new GLocale.Key(b,"tool-category.color"),b.TOOL_CATEGORY_VIEW=new GLocale.Key(b,"tool-category.view"),b.Part={Header:{id:"header"},Toolbar:{id:"toolbar"},Panels:{id:"panels"},Sidebars:{id:"sidebars"},Windows:{id:"windows"},Palettes:{id:"palettes"}},b.DocumentEvent=function(a,b){this.type=a,this.document=b},GObject.inherit(b.DocumentEvent,GEvent),b.DocumentEvent.Type={Added:0,Removed:1,Deactivated:10,Activated:11,UrlUpdated:12},b.DocumentEvent.prototype.type=null,b.DocumentEvent.prototype.document=null,b.DocumentEvent.prototype.toString=function(){return"[Object GApplication.DocumentEvent]"},b.prototype._initialized=!1,b.prototype._toolManager=null,b.prototype._documentUntitledCount=0,b.prototype._documents=null,b.prototype._activeDocument=null,b.prototype._view=null,b.prototype._header=null,b.prototype._toolbar=null,b.prototype._panels=null,b.prototype._sidebars=null,b.prototype._windows=null,b.prototype._palettes=null,b.prototype._resizeTimerId=null,b.prototype._actions=null,b.prototype._sourceTitle=null,b.prototype.getToolManager=function(){return this._toolManager},b.prototype.getDocuments=function(){return this._documents},b.prototype.getActiveDocument=function(){return this._activeDocument?this._activeDocument:null},b.prototype.getHeader=function(){return this._header},b.prototype.getToolbar=function(){return this._toolbar},b.prototype.getPanels=function(){return this._panels},b.prototype.getSidebars=function(){return this._sidebars},b.prototype.getWindows=function(){return this._windows},b.prototype.getPalettes=function(){return this._palettes},b.prototype.isPartVisible=function(a){return"none"!==this.getPart(a).css("display")},b.prototype.setPartVisible=function(a,b){b!=this.isPartVisible(a)&&(this.getPart(a).css("display",b?"block":"none"),this.relayout())},b.prototype.getPart=function(a){return this._view.find("#"+a.id)},b.prototype.getActions=function(){return this._actions},b.prototype.getAction=function(a){for(var b=0;b<this._actions.length;++b)if(this._actions[b].getId()===a)return this._actions[b];return null},b.prototype.getStorage=function(a){var b=new URI(a).protocol();if(b&&b.length)for(var c=0;c<gravit.storages.length;++c)if(gravit.storages[c].getProtocol()===b)return gravit.storages[c];return null},b.prototype.getMatchingStorage=function(a,b,c,d,e){var f=[];e&&f.push(e);for(var g=0;g<gravit.storages.length;++g){var h=gravit.storages[g];h!==e&&f.push(h)}for(var g=0;g<f.length;++g){var h=f[g];if(!(a&&!h.isPrompting()||b&&!h.isSaving())){if(c&&""!==c){var i=h.getExtensions();if(i&&i.length&&i.indexOf(c)<0)continue}if(!d||h.isDirectory())return h}}return null},b.prototype.createNewDocument=function(){var a=new GScene;a.setProperty("unit",GLength.Unit.PX);var b=new GStyle;b.setProperties(["name","_sdf","ps","_bpt","_fpt"],["Shape Default","shape",[GStylable.PropertySet.Style,GStylable.PropertySet.Effects,GStylable.PropertySet.Fill,GStylable.PropertySet.Border],GRGBColor.BLACK,GRGBColor.WHITE]);var c=new GStyle;c.setProperties(["name","_sdf","ps","_fpt"],["Text Default","text",[GStylable.PropertySet.Style,GStylable.PropertySet.Effects,GStylable.PropertySet.Fill,GStylable.PropertySet.Border,GStylable.PropertySet.Text,GStylable.PropertySet.Paragraph],GRGBColor.BLACK]),a.getStyleCollection().appendChild(b),a.getStyleCollection().appendChild(c);var d=this.addDocument(a);return d.createNewPage(!0),d},b.prototype.addDocument=function(a,b){var c=new GDocument(a,null,b?b:"Untitled-"+(++this._documentUntitledCount).toString());return this._addDocument(c),c},b.prototype.openDocument=function(a){for(var b=!1,c=0;c<this._documents.length;++c){var d=this._documents[c];d.getUrl()===a&&(this.activateDocument(d),b=!0)}if(!b){var e=this.getStorage(a);e&&e.load(a,!0,function(b,c){var d=function(b){var d=new GScene,e=new GDocument(d,a,c);try{var f=JSON.parse(b);if(!f)throw new Error("Unable to parse JSON.");GNode.restoreInstance(f,d)}catch(g){e.release(),d=null,e=null,console.log(g),vex.dialog.alert("An error has ocurred while trying to open the document.")}e&&this._addDocument(e)}.bind(this),e=new Uint8Array(b);if(31===e[0]&&139===e[1]&&8===e[2]){var f=pako.ungzip(e,{to:"string"});d(f)}else{var g=new FileReader;g.onload=function(a){d(a.target.result)},g.readAsText(new Blob([b]))}}.bind(this))}},b.prototype.openDocumentFrom=function(a){var b=gApp.getActiveDocument()?gApp.getActiveDocument().getUrl():null;a.openResourcePrompt(b&&""!==b?b:null,["gravit"],function(a){gApp.openDocument(a)})},b.prototype.saveDocumentAs=function(a,c){var c=c||this.getActiveDocument();c&&a.saveResourcePrompt(null,c.getTitle(),"gravit",function(a){c.setUrl(a),c.save(),this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.UrlUpdated,c))}.bind(this))},b.prototype.activateDocument=function(a,c){a!=this._activeDocument&&(this._activeDocument&&(this._activeDocument&&(this._activeDocument.deactivate(),this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Deactivated,this._activeDocument))),this._activeDocument=null),a&&(c||this._windows.activateWindow(a.getActiveWindow()),a.activate(),this._activeDocument=a,this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Activated,a))))},b.prototype.closeDocument=function(a){var c=a.getWindows().length;if(c.length)for(;c.length>0;)c.closeWindow(c[0]);else a===this.getActiveDocument()&&this.activateDocument(null),a.release(),this._documents.splice(this._documents.indexOf(a),1),this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Removed,a))},b.prototype.canExecuteAction=function(a,b){var c=this.getAction(a);return c?c.isAvailable()&&c.isEnabled.apply(c,b):!1},b.prototype.executeAction=function(a,b){var c=this.getAction(a);if(!c)throw new Error("Unable to execute action '"+a+"' - not registered.");if(c.isAvailable()&&c.isEnabled.apply(c,b)){var d=c.execute.apply(c,b);return"undefined"!=typeof d?d:!0}return!1},b.prototype.prepare=function(){},b.prototype.init=function(){for(var a=$("body"),c=0;c<gravit.modules.length;++c){var d=gravit.modules[c];console.log("Init module <"+d.toString()+">"),d.init()}this._view=$("<div></div>").attr("id","workspace").css("display","none").prependTo(a);var e=$("<div></div>").attr("id",b.Part.Windows.id).appendTo(this._view);this._windows=new GWindows(e);var f=$("<div></div>").attr("id",b.Part.Header.id).appendTo(this._view);this._header=new GHeader(f);var g=$("<div></div>").attr("id",b.Part.Toolbar.id).appendTo(this._view);this._toolbar=new GToolbar(g);var h=$("<div></div>").attr("id",b.Part.Panels.id).appendTo(this._view);this._panels=new GPanels(h);var i=$("<div></div>").attr("id",b.Part.Sidebars.id).appendTo(this._view);this._sidebars=new GSidebars(i);var j=$("<div></div>").attr("id",b.Part.Palettes.id).appendTo(this._view);switch(this._palettes=new GPalettes(j),GSystem.hardware){case GSystem.Hardware.Desktop:a.addClass("g-desktop");break;case GSystem.Hardware.Tablet:a.addClass("g-touch"),a.addClass("g-tablet");break;case GSystem.Hardware.Phone:a.addClass("g-touch"),a.addClass("g-phone")}if($(window).resize(function(){null!=this._resizeTimerId&&(clearTimeout(this._resizeTimerId),this._resizeTimerId=null),this._windows.relayout(),this._resizeTimerId=setTimeout(function(){this.relayout(),this._resizeTimerId=null}.bind(this),200)}.bind(this)),this._actions=gravit.actions.slice(),this._createMainMenu(),gravit.tools)for(var k=function(a){return function(){this._toolManager.activateTool(a)}.bind(this)}.bind(this),c=0;c<gravit.tools.length;++c){var l=gravit.tools[c];if(this._toolManager.addTool(l.instance),l.keys&&l.keys.length>0)for(var m=k(l.instance),n=0;n<l.keys.length;++n)this.registerShortcut([l.keys[n]],m)}return this._header.init(),this._toolbar.init(),this._panels.init(),this._sidebars.init(),this._windows.init(),this._palettes.init(),this.setPartVisible(b.Part.Sidebars,!1),this._view.css("display",""),this._initialized=!0,this._windows.addEventListener(GWindows.WindowEvent,this._windowEvent,this),$.Deferred().resolve().promise()},b.prototype.start=function(){return $.Deferred().resolve().promise()},b.prototype.relayout=function(){this._initialized&&setTimeout(function(){var a=0,c=0,d=0,e=0,f=this.getPart(b.Part.Header);a+=this.isPartVisible(b.Part.Header)?f.outerHeight():0;var g=this.getPart(b.Part.Toolbar);g.css("top",a.toString()+"px"),g.height(this._view.height()-a-3),c+=this.isPartVisible(b.Part.Toolbar)?g.outerWidth():0;var h=this.getPart(b.Part.Sidebars);h.css("top",a.toString()+"px"),h.css("left",c.toString()+"px"),h.height(this._view.height()-a),c+=this.isPartVisible(b.Part.Sidebars)?h.outerWidth():0;var i=this.getPart(b.Part.Palettes);i.css("top",a.toString()+"px"),i.height(this._view.height()-a),d+=this.isPartVisible(b.Part.Palettes)?i.outerWidth():0;var j=this.getPart(b.Part.Panels);j.css("left",c.toString()+"px"),j.css("width",(this._view.width()-c-d).toString()+"px"),e+=this.isPartVisible(b.Part.Panels)?j.outerHeight():0,this._header.relayout(),this._toolbar.relayout(),this._panels.relayout(),this._sidebars.relayout(),this._windows.relayout([c,a,d,e]),this._palettes.relayout()}.bind(this),0)},b.prototype.registerShortcut=function(a,b){Mousetrap.bind(this._shortcutToMouseTrapShortcut(a),function(){return b(),!1}.bind(this))},b.prototype._addDocument=function(a){this.hasEventListeners(b.DocumentEvent)&&this.trigger(new b.DocumentEvent(b.DocumentEvent.Type.Added,a)),this._windows.addWindow(a)},b.prototype._createMainMenu=function(){for(var a=[],b={items:[]},c=function(b){for(var c=0;c<a.length;++c)if(a[c].item===b)return a[c].group},d=function(b,d,e){if(b.items.length>0){var f=c(b.items[b.items.length-1]);f!==e&&b.items.push({type:"divider"})}a.push({item:d,group:e})},e=0;e<this._actions.length;++e){var f=this._actions[e];if(f.isAvailable()){var g=ifLocale.get(f.getCategory()),h=f.getGroup(),i=g?g.split("/"):null,j=h?[""].concat(h.split("/")):null;if(j&&i&&i.length!==j.length-1)throw new Error("Number of categories different thant number of groups.");var k=b;if(i)for(var l=0;l<i.length;++l){for(var g=i[l],h=j?j[l]:null,m=null,n=0;n<k.items.length;++n)g==k.items[n].caption&&(m=k.items[n]);m||(m={type:"menu",caption:g,items:[]},d(k,m,h),k.items.push(m)),k=m}var o={type:"item",action:f};d(k,o,j?j[j.length-1]:null),k.items.push(o)}}for(var p=function(a,b){"menu"===a.type?a.menu=q(a,b):"divider"===a.type?a.separator=gHost.addMenuSeparator(b):"item"===a.type&&(a.item=gHost.addMenuItem(b,ifLocale.get(a.action.getTitle()),a.action.isCheckable(),a.action.getShortcut(),function(){this.executeAction(a.action.getId())}.bind(this)))}.bind(this),q=function(a,b){for(var c=gHost.addMenu(b,a.caption,function(){for(var b=0;b<a.items.length;++b){var c=a.items[b];"item"===c.type&&gHost.updateMenuItem(c.item,ifLocale.get(c.action.getTitle()),c.action.isEnabled(),c.action.isCheckable()?c.action.isChecked():!1)}}),d=0;d<a.items.length;++d)p(a.items[d],c);return c},e=0;e<b.items.length;++e){var m=b.items[e];q(b.items[e],null)}},b.prototype._windowEvent=function(a){switch(a.type){case GWindows.WindowEvent.Type.Added:case GWindows.WindowEvent.Type.Removed:this._updateTitle();break;case GWindows.WindowEvent.Type.Activated:this._toolManager.setView(a.window.getView()),this._updateTitle();break;case GWindows.WindowEvent.Type.Deactivated:this._toolManager.setView(null),this._updateTitle()}},b.prototype._updateTitle=function(){this._sourceTitle||(this._sourceTitle=document.title);var a=this._sourceTitle,b=this.getWindows().getActiveWindow();b&&(a+=" - "+b.getTitle()),document.title=a},b.prototype._touchHandler=function(a){function b(a,b){var c=document.createEvent("MouseEvent");c.initMouseEvent(a,!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c)}if(!(a.touches.length>1)){var c=a.changedTouches[0];switch(a.type){case"touchstart":b("mousedown",c);break;case"touchmove":b("mousemove",c);break;case"touchend":b("mouseup",c),b("click",c);break;default:return}a.preventDefault(),a.stopPropagation()}},b.prototype._shortcutToMouseTrapShortcut=function(a){for(var b="",c=0;c<a.length;++c){c>0&&(b+="+");var d=a[c];if("number"==typeof d)switch(d){case GKey.Constant.META:b+="meta";break;case GKey.Constant.OPTION:b+="option";break;case GKey.Constant.REMOVE:b+="del";break;case GKey.Constant.SPACE:b+="space";break;case GKey.Constant.ENTER:b+="enter";break;case GKey.Constant.TAB:b+="tab";break;case GKey.Constant.BACKSPACE:b+="backspace";break;case GKey.Constant.CONTROL:b+="ctrl";break;case GKey.Constant.SHIFT:b+="shift";break;case GKey.Constant.ALT:b+="alt";break;case GKey.Constant.LEFT:b+="left";break;case GKey.Constant.UP:b+="up";break;case GKey.Constant.RIGHT:b+="right";break;case GKey.Constant.DOWN:b+="down";break;case GKey.Constant.PAGE_UP:b+="pageup";break;case GKey.Constant.PAGE_DOWN:b+="pagedown";break;case GKey.Constant.HOME:b+="home";break;case GKey.Constant.END:b+="end";break;case GKey.Constant.INSERT:b+="ins";break;case GKey.Constant.DELETE:b+="del";break;case GKey.Constant.COMMAND:b+="meta";break;case GKey.Constant.F1:b+="f1";break;case GKey.Constant.F2:b+="f2";break;case GKey.Constant.F3:b+="f3";break;case GKey.Constant.F4:b+="f4";break;case GKey.Constant.F5:b+="f5";break;case GKey.Constant.F6:b+="f6";break;case GKey.Constant.F7:b+="f7";break;case GKey.Constant.F8:b+="f8";break;case GKey.Constant.F9:b+="f9";break;case GKey.Constant.F10:b+="f10";break;case GKey.Constant.F11:b+="f11";break;case GKey.Constant.F12:b+="f12";break;default:throw new Error("Unknown key code")}else b+=d.toLowerCase()}return b},a.GApplication=b}(this),function(a){function b(a,b,c){this.setUrl(b),this._scene=a,this._editor=new GEditor(a),this._windows=[],this._activeWindow=null,this._title=c,this._scene.addEventListener(GScene.ResolveUrlEvent,this._resolveUrl,this),this._editor.addEventListener(GEditor.FileDropEvent,this._dropFile,this)}GObject.inherit(b,GEventTarget),b.prototype._scene=null,b.prototype._url=null,b.prototype._editor=null,b.prototype._windows=null,b.prototype._activeWindow=null,b.prototype._title=null,b.prototype.getScene=function(){return this._scene},b.prototype.getStorage=function(){return this._storage},b.prototype.getUrl=function(){return this._url},b.prototype.setUrl=function(a){a!==this._url&&(this._storage&&this._storage.releaseUrl(this._url),this._url=a,this._storage=a?gApp.getStorage(a):null)},b.prototype.getEditor=function(){return this._editor},b.prototype.getWindows=function(){return this._windows},b.prototype.getActiveWindow=function(){return this._activeWindow},b.prototype.getTitle=function(){return this._title},b.prototype.isSaveable=function(){return!!this._storage},b.prototype.save=function(){if(this._url){var a=GNode.serialize(this._scene),b=pako.gzip(a,{level:9});this._storage.save(this._url,b.buffer,!0,function(a){this._title=a}.bind(this))}},b.prototype.importFile=function(a,b){var c=a.name;if(c&&c.lastIndexOf(".")>0&&(c=c.substr(0,c.lastIndexOf("."))),a.type.match(/image.*/)){var d=function(){var d=new FileReader;d.onload=function(a){var d=new GImage;d.setProperties(["name","url"],[c,a.target.result]),this._editor.insertElements([d]),b(d)}.bind(this),d.readAsDataURL(a)}.bind(this);"image/svg+xml"===a.type?vex.dialog.confirm({message:"Convert the image to vectors?",callback:function(c){if(c){var e=this._scene.getActivePage(),f=this._scene.getActiveLayer();GIO.read("image/svg+xml",a,function(a){a&&(f.appendChild(a),b(a))},{baseWidth:e.getProperty("w"),baseHeight:e.getProperty("h")})}else d()}.bind(this)}):d()}},b.prototype.createNewPage=function(a){var b=this._scene,c=this._scene.getPageInsertPosition(),d=new GPage;d.setProperties(["name","x","y","w","h","bck"],["Page "+(b.queryCount("> page")+1).toString(),c.getX(),c.getY(),800,600,GRGBColor.WHITE]);var e=new GLayer;e.setProperties(["name"],["Background"]),d.appendChild(e);var f=function(){b.appendChild(d),b.setActiveLayer(e)};return a?f():GEditor.tryRunTransaction(b,f,"Add new Page"),d},b.prototype.activate=function(){},b.prototype.deactivate=function(){},b.prototype.release=function(){this._editor.release(),this._scene.removeEventListener(GScene.ResolveUrlEvent,this._resolveUrl,this),this._editor.removeEventListener(GEditor.FileDropEvent,this._dropFile,this),this._storage&&this._storage.releaseUrl(this._url)},b.prototype._resolveUrl=function(a){var b=new URI(a.url);if(0===b.protocol().length&&(b=b.absoluteTo(this._url)),b.protocol().length>0){("http"===b.protocol()||"https"===b.protocol())&&a.resolved(a.url);var c=gApp.getStorage(b.protocol()+":");c&&c.resolveUrl(b.toString(),a.resolved)}},b.prototype._dropFile=function(a){this.importFile(a.file,function(b){b instanceof GElement&&b.hasMixin(GElement.Transform)&&b.transform(new GTransform(1,0,0,1,a.position.getX(),a.position.getY()))})},a.GDocument=b}(this),ifLocale.setValues(GApplication,GLocale.Language.English,["category.file","category.edit","category.modify","category.modify.arrange","category.modify.align","category.modify.transform","category.modify.paths","category.modify.page","category.modify.layer","category.arrange","category.arrange.transform","category.view","category.view.magnification","category.help","tool-category.select","tool-category.image","tool-category.vector","tool-category.other","tool-category.color","tool-category.view"],["File","Edit","Modify","Modify/Arrange","Modify/Align","Modify/Transform","Modify/Paths","Modify/Page","Modify/Layer","Arrange","Arrange/Transform","View","View/Magnification","Help","Select","Image","Vector","Other","Color","View"]);