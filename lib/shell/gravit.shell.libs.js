(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=[].slice,A={}.hasOwnProperty,B=function(a,b){function c(){this.constructor=a}for(var d in b)A.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};x="0.22.0",a=this.jQuery,r=function(){function b(b,c){this.$el=a(b),this.options=a.extend({},this.defaults,c)}return b.prototype.defaults={},b.prototype.destroy=function(){return this._deinit()},b.prototype._init=function(){return null},b.prototype._deinit=function(){return null},b.register=function(c,d){var e,f,g,h,i;return h=function(){return"simple_widget_"+d},i=function(c,d){var e;return e=a.data(c,d),e&&e instanceof b?e:null},f=function(b,d){var e,f,g,j,k,l;for(e=h(),k=0,l=b.length;l>k;k++)f=b[k],g=i(f,e),g||(j=new c(f,d),a.data(f,e)||a.data(f,e,j),j._init());return b},g=function(b){var c,d,e,f,g,j;for(c=h(),j=[],f=0,g=b.length;g>f;f++)d=b[f],e=i(d,c),e&&e.destroy(),j.push(a.removeData(d,c));return j},e=function(c,d,e){var f,g,i,j,k,l;for(g=null,k=0,l=c.length;l>k;k++)f=c[k],i=a.data(f,h()),i&&i instanceof b&&(j=i[d],j&&"function"==typeof j&&(g=j.apply(i,e)));return g},a.fn[d]=function(){var a,b,c,d,h;return c=arguments[0],b=2<=arguments.length?z.call(arguments,1):[],a=this,void 0===c||"object"==typeof c?(h=c,f(a,h)):"string"==typeof c&&"_"!==c[0]?(d=c,"destroy"===d?g(a):e(a,d,b)):void 0}},b}(),this.SimpleWidget=r,k=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return B(c,b),c.is_mouse_handled=!1,c.prototype._init=function(){return this.$el.bind("mousedown.mousewidget",a.proxy(this._mouseDown,this)),this.$el.bind("touchstart.mousewidget",a.proxy(this._touchStart,this)),this.is_mouse_started=!1,this.mouse_delay=0,this._mouse_delay_timer=null,this._is_mouse_delay_met=!0,this.mouse_down_info=null},c.prototype._deinit=function(){var b;return this.$el.unbind("mousedown.mousewidget"),this.$el.unbind("touchstart.mousewidget"),b=a(document),b.unbind("mousemove.mousewidget"),b.unbind("mouseup.mousewidget")},c.prototype._mouseDown=function(a){var b;if(1===a.which)return b=this._handleMouseDown(a,this._getPositionInfo(a)),b&&a.preventDefault(),b},c.prototype._handleMouseDown=function(a,b){return!c.is_mouse_handled&&(this.is_mouse_started&&this._handleMouseUp(b),this.mouse_down_info=b,this._mouseCapture(b))?(this._handleStartMouse(),this.is_mouse_handled=!0,!0):void 0},c.prototype._handleStartMouse=function(){var b;return b=a(document),b.bind("mousemove.mousewidget",a.proxy(this._mouseMove,this)),b.bind("touchmove.mousewidget",a.proxy(this._touchMove,this)),b.bind("mouseup.mousewidget",a.proxy(this._mouseUp,this)),b.bind("touchend.mousewidget",a.proxy(this._touchEnd,this)),this.mouse_delay?this._startMouseDelayTimer():void 0},c.prototype._startMouseDelayTimer=function(){return this._mouse_delay_timer&&clearTimeout(this._mouse_delay_timer),this._mouse_delay_timer=setTimeout(function(a){return function(){return a._is_mouse_delay_met=!0}}(this),this.mouse_delay),this._is_mouse_delay_met=!1},c.prototype._mouseMove=function(a){return this._handleMouseMove(a,this._getPositionInfo(a))},c.prototype._handleMouseMove=function(a,b){return this.is_mouse_started?(this._mouseDrag(b),a.preventDefault()):this.mouse_delay&&!this._is_mouse_delay_met?!0:(this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==!1,this.is_mouse_started?this._mouseDrag(b):this._handleMouseUp(b),!this.is_mouse_started)},c.prototype._getPositionInfo=function(a){return{page_x:a.pageX,page_y:a.pageY,target:a.target,original_event:a}},c.prototype._mouseUp=function(a){return this._handleMouseUp(this._getPositionInfo(a))},c.prototype._handleMouseUp=function(b){var c;c=a(document),c.unbind("mousemove.mousewidget"),c.unbind("touchmove.mousewidget"),c.unbind("mouseup.mousewidget"),c.unbind("touchend.mousewidget"),this.is_mouse_started&&(this.is_mouse_started=!1,this._mouseStop(b))},c.prototype._mouseCapture=function(){return!0},c.prototype._mouseStart=function(){return null},c.prototype._mouseDrag=function(){return null},c.prototype._mouseStop=function(){return null},c.prototype.setMouseDelay=function(a){return this.mouse_delay=a},c.prototype._touchStart=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseDown(a,this._getPositionInfo(b))},c.prototype._touchMove=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseMove(a,this._getPositionInfo(b))},c.prototype._touchEnd=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseUp(this._getPositionInfo(b))},c}(r),this.Tree={},a=this.jQuery,n={getName:function(a){return n.strings[a-1]},nameToIndex:function(a){var b,c,d;for(b=c=1,d=n.strings.length;d>=1?d>=c:c>=d;b=d>=1?++c:--c)if(n.strings[b-1]===a)return b;return 0}},n.BEFORE=1,n.AFTER=2,n.INSIDE=3,n.NONE=4,n.strings=["before","after","inside","none"],this.Tree.Position=n,l=function(){function b(a,c,d){null==c&&(c=!1),null==d&&(d=b),this.setData(a),this.children=[],this.parent=null,c&&(this.id_mapping={},this.tree=this,this.node_class=d)}return b.prototype.setData=function(a){var b,c,d;if("object"!=typeof a)return this.name=a;d=[];for(b in a)c=a[b],d.push("label"===b?this.name=c:this[b]=c);return d},b.prototype.initFromData=function(a){var b,c;return c=function(a){return function(c){return a.setData(c),c.children?b(c.children):void 0}}(this),b=function(a){return function(b){var c,d,e,f;for(e=0,f=b.length;f>e;e++)c=b[e],d=new a.tree.node_class(""),d.initFromData(c),a.addChild(d);return null}}(this),c(a),null},b.prototype.loadFromData=function(a){var b,c,d,e;for(this.removeChildren(),d=0,e=a.length;e>d;d++)c=a[d],b=new this.tree.node_class(c),this.addChild(b),"object"==typeof c&&c.children&&b.loadFromData(c.children);return null},b.prototype.addChild=function(a){return this.children.push(a),a._setParent(this)},b.prototype.addChildAtPosition=function(a,b){return this.children.splice(b,0,a),a._setParent(this)},b.prototype._setParent=function(a){return this.parent=a,this.tree=a.tree,this.tree.addNodeToIndex(this)},b.prototype.removeChild=function(a){return a.removeChildren(),this._removeChild(a)},b.prototype._removeChild=function(a){return this.children.splice(this.getChildIndex(a),1),this.tree.removeNodeFromIndex(a)},b.prototype.getChildIndex=function(b){return a.inArray(b,this.children)},b.prototype.hasChildren=function(){return 0!==this.children.length},b.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand},b.prototype.iterate=function(a){var b;return b=function(c){return function(d,e){var f,g,h,i,j;if(d.children){for(j=d.children,h=0,i=j.length;i>h;h++)f=j[h],g=a(f,e),c.hasChildren()&&g&&b(f,e+1);return null}}}(this),b(this,0),null},b.prototype.moveNode=function(a,b,c){return a.isParentOf(b)?void 0:(a.parent._removeChild(a),c===n.AFTER?b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)+1):c===n.BEFORE?b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)):c===n.INSIDE?b.addChildAtPosition(a,0):void 0)},b.prototype.getData=function(){var a;return(a=function(){return function(b){var c,d,e,f,g,h,i;for(c=[],h=0,i=b.length;i>h;h++){e=b[h],f={};for(d in e)g=e[d],"parent"!==d&&"children"!==d&&"element"!==d&&"tree"!==d&&Object.prototype.hasOwnProperty.call(e,d)&&(f[d]=g);e.hasChildren()&&(f.children=a(e.children)),c.push(f)}return c}}(this))(this.children)},b.prototype.getNodeByName=function(a){var b;return b=null,this.iterate(function(c){return c.name===a?(b=c,!1):!0}),b},b.prototype.addAfter=function(a){var b,c;return this.parent?(c=new this.tree.node_class(a),b=this.parent.getChildIndex(this),this.parent.addChildAtPosition(c,b+1),c):null},b.prototype.addBefore=function(a){var b,c;return this.parent?(c=new this.tree.node_class(a),b=this.parent.getChildIndex(this),this.parent.addChildAtPosition(c,b),c):null},b.prototype.addParent=function(a){var b,c,d,e,f,g;if(this.parent){for(c=new this.tree.node_class(a),c._setParent(this.tree),d=this.parent,g=d.children,e=0,f=g.length;f>e;e++)b=g[e],c.addChild(b);return d.children=[],d.addChild(c),c}return null},b.prototype.remove=function(){return this.parent?(this.parent.removeChild(this),this.parent=null):void 0},b.prototype.append=function(a){var b;return b=new this.tree.node_class(a),this.addChild(b),b},b.prototype.prepend=function(a){var b;return b=new this.tree.node_class(a),this.addChildAtPosition(b,0),b},b.prototype.isParentOf=function(a){var b;for(b=a.parent;b;){if(b===this)return!0;b=b.parent}return!1},b.prototype.getLevel=function(){var a,b;for(a=0,b=this;b.parent;)a+=1,b=b.parent;return a},b.prototype.getNodeById=function(a){return this.id_mapping[a]},b.prototype.addNodeToIndex=function(a){return null!=a.id?this.id_mapping[a.id]=a:void 0},b.prototype.removeNodeFromIndex=function(a){return null!=a.id?delete this.id_mapping[a.id]:void 0},b.prototype.removeChildren=function(){return this.iterate(function(a){return function(b){return a.tree.removeNodeFromIndex(b),!0}}(this)),this.children=[]},b.prototype.getPreviousSibling=function(){var a;return this.parent?(a=this.parent.getChildIndex(this)-1,a>=0?this.parent.children[a]:null):null},b.prototype.getNextSibling=function(){var a;return this.parent?(a=this.parent.getChildIndex(this)+1,a<this.parent.children.length?this.parent.children[a]:null):null},b.prototype.getNodesByProperty=function(a,b){return this.filter(function(c){return c[a]===b})},b.prototype.filter=function(a){var b;return b=[],this.iterate(function(c){return a(c)&&b.push(c),!0}),b},b}(),this.Tree.Node=l,e=function(){function b(a){this.tree_widget=a,this.opened_icon_element=this.createButtonElement(a.options.openedIcon),this.closed_icon_element=this.createButtonElement(a.options.closedIcon)}return b.prototype.render=function(a){return a&&a.parent?this.renderFromNode(a):this.renderFromRoot()},b.prototype.renderNode=function(b){var c,d,e;return a(b.element).remove(),d=new m(b.parent,this.tree_widget),c=this.createLi(b),this.attachNodeData(b,c),e=b.getPreviousSibling(),e?a(e.element).after(c):d.getUl().prepend(c),b.children?this.renderFromNode(b):void 0},b.prototype.renderFromRoot=function(){var a;return a=this.tree_widget.element,a.empty(),this.createDomElements(a[0],this.tree_widget.tree.children,!0,!0)},b.prototype.renderFromNode=function(a){var b;return b=this.tree_widget._getNodeElementForNode(a),b.getUl().remove(),this.createDomElements(b.$element[0],a.children,!1,!1)},b.prototype.createDomElements=function(a,b,c){var d,e,f,g,h;for(f=this.createUl(c),a.appendChild(f),g=0,h=b.length;h>g;g++)d=b[g],e=this.createLi(d),f.appendChild(e),this.attachNodeData(d,e),d.hasChildren()&&this.createDomElements(e,d.children,!1,d.is_open);return null},b.prototype.attachNodeData=function(b,c){return b.element=c,a(c).data("node",b)},b.prototype.createUl=function(a){var b,c;return b=a?"jqtree-tree":"",c=document.createElement("ul"),c.className="jqtree_common "+b,c},b.prototype.createLi=function(b){var c;return c=b.isFolder()?this.createFolderLi(b):this.createNodeLi(b),this.tree_widget.options.onCreateLi&&this.tree_widget.options.onCreateLi(b,a(c)),c},b.prototype.createFolderLi=function(a){var b,c,d,e,f,g,h,i;return b=this.getButtonClasses(a),f=this.getFolderClasses(a),e=this.escapeIfNecessary(a.name),g=a.is_open?this.opened_icon_element:this.closed_icon_element,h=document.createElement("li"),h.className="jqtree_common "+f,d=document.createElement("div"),d.className="jqtree-element jqtree_common",h.appendChild(d),c=document.createElement("a"),c.className="jqtree_common "+b,c.appendChild(g.cloneNode()),d.appendChild(c),i=document.createElement("span"),i.className="jqtree_common jqtree-title jqtree-title-folder",d.appendChild(i),i.innerHTML=e,h},b.prototype.createNodeLi=function(a){var b,c,d,e,f,g;return f=["jqtree_common"],this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(a)&&f.push("jqtree-selected"),b=f.join(" "),d=this.escapeIfNecessary(a.name),e=document.createElement("li"),e.className=b,c=document.createElement("div"),c.className="jqtree-element jqtree_common",e.appendChild(c),g=document.createElement("span"),g.className="jqtree-title jqtree_common",g.innerHTML=d,c.appendChild(g),e},b.prototype.getButtonClasses=function(a){var b;return b=["jqtree-toggler"],a.is_open||b.push("jqtree-closed"),b.join(" ")},b.prototype.getFolderClasses=function(a){var b;return b=["jqtree-folder"],a.is_open||b.push("jqtree-closed"),this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(a)&&b.push("jqtree-selected"),b.join(" ")},b.prototype.escapeIfNecessary=function(a){return this.tree_widget.options.autoEscape?u(a):a},b.prototype.createButtonElement=function(b){var c;return"string"==typeof b?(c=document.createElement("div"),c.innerHTML=b,document.createTextNode(c.innerHTML)):a(b)[0]},b}(),i=function(b){function d(){return d.__super__.constructor.apply(this,arguments)}return B(d,b),d.prototype.defaults={autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!0,useContextMenu:!0,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:!0,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:!0,nodeClass:l,dataFilter:null,keyboardSupport:!0,openFolderDelay:500},d.prototype.toggle=function(a,b){return null==b&&(b=null),null===b&&(b=this.options.slide),a.is_open?this.closeNode(a,b):this.openNode(a,b)},d.prototype.getTree=function(){return this.tree},d.prototype.selectNode=function(a){return this._selectNode(a,!1)},d.prototype._selectNode=function(a,b){var c,d,e,f;if(null==b&&(b=!1),this.select_node_handler){if(c=function(b){return function(){return b.options.onCanSelectNode?b.options.selectable&&b.options.onCanSelectNode(a):b.options.selectable}}(this),e=function(b){return function(){var c;return c=a.parent,c&&c.parent&&!c.is_open?b.openNode(c,!1):void 0}}(this),f=function(a){return function(){return a.options.saveState?a.save_state_handler.saveState():void 0}}(this),!a)return this._deselectCurrentNode(),void f();if(c())return this.select_node_handler.isNodeSelected(a)?b&&(this._deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:a})):(d=this.getSelectedNode(),this._deselectCurrentNode(),this.addToSelection(a),this._triggerEvent("tree.select",{node:a,deselected_node:d}),e()),f()}},d.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()},d.prototype.toJson=function(){return JSON.stringify(this.tree.getData())},d.prototype.loadData=function(a,b){return this._loadData(a,b)},d.prototype.loadDataFromUrl=function(b,c,d){return"string"!==a.type(b)&&(d=c,c=b,b=null),this._loadDataFromUrl(b,c,d)},d.prototype.reload=function(){return this.loadDataFromUrl()},d.prototype._loadDataFromUrl=function(b,c,d){var e,g,h,i,j,k;if(e=null,g=function(a){return function(){var b;return c?(b=new f(c,a),e=b.getLi()):e=a.element,e.addClass("jqtree-loading")}}(this),k=function(){return function(){return e?e.removeClass("jqtree-loading"):void 0}}(this),j=function(){return function(){return"string"===a.type(b)&&(b={url:b}),b.method?void 0:b.method="get"}}(this),h=function(b){return function(e){return k(),b._loadData(e,c),d&&a.isFunction(d)?d():void 0}}(this),i=function(c){return function(){return j(),a.ajax({url:b.url,data:b.data,type:b.method.toUpperCase(),cache:!1,dataType:"json",success:function(b){var d;return d=a.isArray(b)||"object"==typeof b?b:a.parseJSON(b),c.options.dataFilter&&(d=c.options.dataFilter(d)),h(d)},error:function(a){return k(),c.options.onLoadFailed?c.options.onLoadFailed(a):void 0}})}}(this),b||(b=this._getDataUrlInfo(c)),g(),b){if(!a.isArray(b))return i();h(b)}else k()},d.prototype._loadData=function(a,b){var c,d,e,f;if(a){if(this._triggerEvent("tree.load_data",{tree_data:a}),b){for(d=this.select_node_handler.getSelectedNodesUnder(b),e=0,f=d.length;f>e;e++)c=d[e],this.select_node_handler.removeFromSelection(c);b.loadFromData(a),b.load_on_demand=!1,this._refreshElements(b.parent)}else this._initTree(a);return this.isDragging()?this.dnd_handler.refresh():void 0}},d.prototype.getNodeById=function(a){return this.tree.getNodeById(a)},d.prototype.getNodeByName=function(a){return this.tree.getNodeByName(a)},d.prototype.openNode=function(a,b){return null==b&&(b=null),null===b&&(b=this.options.slide),this._openNode(a,b)},d.prototype._openNode=function(a,b,c){var d,e;if(null==b&&(b=!0),d=function(a){return function(b,c,d){var e;return e=new f(b,a),e.open(d,c)}}(this),a.isFolder()){if(a.load_on_demand)return this._loadFolderOnDemand(a,b,c);for(e=a.parent;e&&!e.is_open;)e.parent&&d(e,!1,null),e=e.parent;return d(a,b,c),this._saveState()}},d.prototype._loadFolderOnDemand=function(a,b,c){return null==b&&(b=!0),this._loadDataFromUrl(null,a,function(d){return function(){return d._openNode(a,b,c)}}(this))},d.prototype.closeNode=function(a,b){return null==b&&(b=null),null===b&&(b=this.options.slide),a.isFolder()?(new f(a,this).close(b),this._saveState()):void 0},d.prototype.isDragging=function(){return this.dnd_handler?this.dnd_handler.is_dragging:!1},d.prototype.refreshHitAreas=function(){return this.dnd_handler.refresh()},d.prototype.addNodeAfter=function(a,b){var c;return c=b.addAfter(a),this._refreshElements(b.parent),c},d.prototype.addNodeBefore=function(a,b){var c;return c=b.addBefore(a),this._refreshElements(b.parent),c},d.prototype.addParentNode=function(a,b){var c;return c=b.addParent(a),this._refreshElements(c.parent),c},d.prototype.removeNode=function(a){var b;return b=a.parent,b?(this.select_node_handler.removeFromSelection(a,!0),a.remove(),this._refreshElements(b.parent)):void 0},d.prototype.appendNode=function(a,b){var c,d;return b||(b=this.tree),c=b.isFolder(),d=b.append(a),this._refreshElements(c?b:b.parent),d},d.prototype.prependNode=function(a,b){var c;return b||(b=this.tree),c=b.prepend(a),this._refreshElements(b),c},d.prototype.updateNode=function(a,b){var c;return c=b.id&&b.id!==a.id,c&&this.tree.removeNodeFromIndex(a),a.setData(b),c&&this.tree.addNodeToIndex(a),this.renderer.renderNode(a),this._selectCurrentNode()},d.prototype.moveNode=function(a,b,c){var d;return d=n.nameToIndex(c),this.tree.moveNode(a,b,d),this._refreshElements()},d.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()},d.prototype.addToSelection=function(a){return a?(this.select_node_handler.addToSelection(a),this._getNodeElementForNode(a).select(),this._saveState()):void 0},d.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()},d.prototype.isNodeSelected=function(a){return this.select_node_handler.isNodeSelected(a)},d.prototype.removeFromSelection=function(a){return this.select_node_handler.removeFromSelection(a),this._getNodeElementForNode(a).deselect(),this._saveState()},d.prototype.scrollToNode=function(b){var c,d;return c=a(b.element),d=c.offset().top-this.$el.offset().top,this.scroll_handler.scrollTo(d)},d.prototype.getState=function(){return this.save_state_handler.getState()},d.prototype.setState=function(a){return this.save_state_handler.setState(a),this._refreshElements()},d.prototype.setOption=function(a,b){return this.options[a]=b},d.prototype.getVersion=function(){return x},d.prototype._init=function(){return d.__super__._init.call(this),this.element=this.$el,this.mouse_delay=300,this.is_initialized=!1,this.renderer=new e(this),"undefined"!=typeof o&&null!==o?this.save_state_handler=new o(this):this.options.saveState=!1,"undefined"!=typeof q&&null!==q&&(this.select_node_handler=new q(this)),"undefined"!=typeof c&&null!==c?this.dnd_handler=new c(this):this.options.dragAndDrop=!1,"undefined"!=typeof p&&null!==p&&(this.scroll_handler=new p(this)),"undefined"!=typeof j&&null!==j&&"undefined"!=typeof q&&null!==q&&(this.key_handler=new j(this)),this._initData(),this.element.click(a.proxy(this._click,this)),this.element.dblclick(a.proxy(this._dblclick,this)),this.options.useContextMenu?this.element.bind("contextmenu",a.proxy(this._contextmenu,this)):void 0},d.prototype._deinit=function(){return this.element.empty(),this.element.unbind(),this.key_handler.deinit(),this.tree=null,d.__super__._deinit.call(this)},d.prototype._initData=function(){return this.options.data?this._loadData(this.options.data):this._loadDataFromUrl(this._getDataUrlInfo())},d.prototype._getDataUrlInfo=function(b){var c,d;return c=this.options.dataUrl||this.element.data("url"),d=function(a){return function(){var d,e,f;return f={url:c},b&&b.id?(d={node:b.id},f.data=d):(e=a._getNodeIdToBeSelected(),e&&(d={selected_node:e},f.data=d)),f}}(this),a.isFunction(c)?c(b):"string"===a.type(c)?d():c},d.prototype._getNodeIdToBeSelected=function(){return this.options.saveState?this.save_state_handler.getNodeIdToBeSelected():null},d.prototype._initTree=function(a){return this.tree=new this.options.nodeClass(null,!0,this.options.nodeClass),this.select_node_handler&&this.select_node_handler.clear(),this.tree.loadFromData(a),this._openNodes(),this._refreshElements(),this.is_initialized?void 0:(this.is_initialized=!0,this._triggerEvent("tree.init"))},d.prototype._openNodes=function(){var a;if(!(this.options.saveState&&this.save_state_handler.restoreState()||this.options.autoOpen===!1))return a=this.options.autoOpen===!0?-1:parseInt(this.options.autoOpen),this.tree.iterate(function(b,c){return b.hasChildren()&&(b.is_open=!0),c!==a})},d.prototype._refreshElements=function(a){return null==a&&(a=null),this.renderer.render(a),this._triggerEvent("tree.refresh")},d.prototype._click=function(a){var b,c,d;if(b=this._getClickTarget(a.target)){if("button"===b.type)return this.toggle(b.node,this.options.slide),a.preventDefault(),a.stopPropagation();if("label"===b.type&&(d=b.node,c=this._triggerEvent("tree.click",{node:d,click_event:a}),!c.isDefaultPrevented()))return this._selectNode(d,!0)}},d.prototype._dblclick=function(a){var b;return b=this._getClickTarget(a.target),b&&"label"===b.type?this._triggerEvent("tree.dblclick",{node:b.node,click_event:a}):void 0},d.prototype._getClickTarget=function(b){var c,d,e,f;if(e=a(b),c=e.closest(".jqtree-toggler"),c.length){if(f=this._getNode(c))return{type:"button",node:f}}else if(d=e.closest(".jqtree-element"),d.length&&(f=this._getNode(d)))return{type:"label",node:f};return null},d.prototype._getNode=function(a){var b;return b=a.closest("li.jqtree_common"),0===b.length?null:b.data("node")},d.prototype._getNodeElementForNode=function(a){return a.isFolder()?new f(a,this):new m(a,this)},d.prototype._getNodeElement=function(a){var b;return b=this._getNode(a),b?this._getNodeElementForNode(b):null},d.prototype._contextmenu=function(b){var c,d;return c=a(b.target).closest("ul.jqtree-tree .jqtree-element"),c.length&&(d=this._getNode(c))?(b.preventDefault(),b.stopPropagation(),this._triggerEvent("tree.contextmenu",{node:d,click_event:b}),!1):void 0},d.prototype._saveState=function(){return this.options.saveState?this.save_state_handler.saveState():void 0},d.prototype._mouseCapture=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseCapture(a):!1},d.prototype._mouseStart=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStart(a):!1},d.prototype._mouseDrag=function(a){var b;return this.options.dragAndDrop?(b=this.dnd_handler.mouseDrag(a),this.scroll_handler&&this.scroll_handler.checkScrolling(),b):!1},d.prototype._mouseStop=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStop(a):!1},d.prototype._triggerEvent=function(b,c){var d;return d=a.Event(b),a.extend(d,c),this.element.trigger(d),d},d.prototype.testGenerateHitAreas=function(a){return this.dnd_handler.current_item=this._getNodeElementForNode(a),this.dnd_handler.generateHitAreas(),this.dnd_handler.hit_areas},d.prototype._selectCurrentNode=function(){var a,b;return a=this.getSelectedNode(),a&&(b=this._getNodeElementForNode(a))?b.select():void 0},d.prototype._deselectCurrentNode=function(){var a;return a=this.getSelectedNode(),a?this.removeFromSelection(a):void 0},d}(k),r.register(i,"tree"),m=function(){function c(a,b){this.init(a,b)}return c.prototype.init=function(b,c){return this.node=b,this.tree_widget=c,b.element||(b.element=this.tree_widget.element),this.$element=a(b.element)},c.prototype.getUl=function(){return this.$element.children("ul:first")},c.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")},c.prototype.getLi=function(){return this.$element},c.prototype.addDropHint=function(a){return a===n.INSIDE?new b(this.$element):new g(this.node,this.$element,a)},c.prototype.select=function(){return this.getLi().addClass("jqtree-selected")},c.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")},c}(),f=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return B(c,a),c.prototype.open=function(a,b){var c,d;return null==b&&(b=!0),this.node.is_open?void 0:(this.node.is_open=!0,c=this.getButton(),c.removeClass("jqtree-closed"),c.html(""),c.append(this.tree_widget.renderer.opened_icon_element.cloneNode()),d=function(b){return function(){return b.getLi().removeClass("jqtree-closed"),a&&a(),b.tree_widget._triggerEvent("tree.open",{node:b.node})}}(this),b?this.getUl().slideDown("fast",d):(this.getUl().show(),d()))},c.prototype.close=function(a){var b,c;return null==a&&(a=!0),this.node.is_open?(this.node.is_open=!1,b=this.getButton(),b.addClass("jqtree-closed"),b.html(""),b.append(this.tree_widget.renderer.closed_icon_element.cloneNode()),c=function(a){return function(){return a.getLi().addClass("jqtree-closed"),a.tree_widget._triggerEvent("tree.close",{node:a.node})}}(this),a?this.getUl().slideUp("fast",c):(this.getUl().hide(),c())):void 0},c.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")},c.prototype.addDropHint=function(a){return this.node.is_open||a!==n.INSIDE?new g(this.node,this.$element,a):new b(this.$element)},c}(m),u=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},y=function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],d===b)return c;return-1},v=function(a,b){return a.indexOf?a.indexOf(b):y(a,b)},this.Tree.indexOf=v,this.Tree._indexOf=y,w=function(a){return"number"==typeof a&&a%1===0},t=function(){var a,b,c,d,e;return a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c=function(c){return a.lastIndex=0,a.test(c)?'"'+c.replace(a,function(a){var c;return c=b[a],"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'},d=function(a,b){var e,f,g,h,i,j,k;switch(i=b[a],typeof i){case"string":return c(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(e=j=0,k=i.length;k>j;e=++j)h=i[e],g[e]=d(e,i)||"null";return 0===g.length?"[]":"["+g.join(",")+"]"}for(f in i)Object.prototype.hasOwnProperty.call(i,f)&&(h=d(f,i),h&&g.push(c(f)+":"+h));return 0===g.length?"{}":"{"+g.join(",")+"}"}},e=function(a){return d("",{"":a})}},this.Tree.get_json_stringify_function=t,(null==this.JSON||null==this.JSON.stringify||"function"!=typeof this.JSON.stringify)&&(null==this.JSON&&(this.JSON={}),this.JSON.stringify=t()),o=function(){function b(a){this.tree_widget=a}return b.prototype.saveState=function(){var b;return b=JSON.stringify(this.getState()),this.tree_widget.options.onSetStateFromStorage?this.tree_widget.options.onSetStateFromStorage(b):this.supportsLocalStorage()?localStorage.setItem(this.getCookieName(),b):a.cookie?(a.cookie.raw=!0,a.cookie(this.getCookieName(),b,{path:"/"})):void 0},b.prototype.restoreState=function(){var a;return a=this.getStateFromStorage(),a?(this.setState(a),!0):!1},b.prototype.getStateFromStorage=function(){var a;return a=this._loadFromStorage(),a?this._parseState(a):null},b.prototype._parseState=function(b){var c;return c=a.parseJSON(b),c&&c.selected_node&&w(c.selected_node)&&(c.selected_node=[c.selected_node]),c},b.prototype._loadFromStorage=function(){return this.tree_widget.options.onGetStateFromStorage?this.tree_widget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getCookieName()):a.cookie?(a.cookie.raw=!0,a.cookie(this.getCookieName())):null},b.prototype.getState=function(){var a,b;return a=function(a){return function(){var b;return b=[],a.tree_widget.tree.iterate(function(a){return a.is_open&&a.id&&a.hasChildren()&&b.push(a.id),!0}),b}}(this),b=function(a){return function(){var b;return function(){var a,c,d,e;for(d=this.tree_widget.getSelectedNodes(),e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b.id);return e}.call(a)}}(this),{open_nodes:a(),selected_node:b()}},b.prototype.setState=function(a){var b,c,d,e,f,g,h;if(a&&(c=a.open_nodes,e=a.selected_node,this.tree_widget.tree.iterate(function(){return function(a){return a.is_open=a.id&&a.hasChildren()&&v(c,a.id)>=0,!0}}(this)),e&&this.tree_widget.select_node_handler)){for(this.tree_widget.select_node_handler.clear(),h=[],f=0,g=e.length;g>f;f++)b=e[f],d=this.tree_widget.getNodeById(b),h.push(d?this.tree_widget.select_node_handler.addToSelection(d):void 0);return h}},b.prototype.getCookieName=function(){return"string"==typeof this.tree_widget.options.saveState?this.tree_widget.options.saveState:"tree"},b.prototype.supportsLocalStorage=function(){var a;return a=function(){var a,b;if("undefined"==typeof localStorage||null===localStorage)return!1;try{b="_storage_test",sessionStorage.setItem(b,!0),sessionStorage.removeItem(b)}catch(c){return a=c,!1}return!0},null==this._supportsLocalStorage&&(this._supportsLocalStorage=a()),this._supportsLocalStorage},b.prototype.getNodeIdToBeSelected=function(){var a;return a=this.getStateFromStorage(),a&&a.selected_node?a.selected_node[0]:null},b}(),q=function(){function a(a){this.tree_widget=a,this.clear()}return a.prototype.getSelectedNode=function(){var a;return a=this.getSelectedNodes(),a.length?a[0]:!1},a.prototype.getSelectedNodes=function(){var a,b,c;if(this.selected_single_node)return[this.selected_single_node];c=[];for(a in this.selected_nodes)b=this.tree_widget.getNodeById(a),b&&c.push(b);return c},a.prototype.getSelectedNodesUnder=function(a){var b,c,d;if(this.selected_single_node)return a.isParentOf(this.selected_single_node)?[this.selected_single_node]:[];d=[];for(b in this.selected_nodes)c=this.tree_widget.getNodeById(b),c&&a.isParentOf(c)&&d.push(c);return d},a.prototype.isNodeSelected=function(a){return a.id?this.selected_nodes[a.id]:this.selected_single_node?this.selected_single_node.element===a.element:!1},a.prototype.clear=function(){return this.selected_nodes={},this.selected_single_node=null},a.prototype.removeFromSelection=function(a,b){if(null==b&&(b=!1),a.id){if(delete this.selected_nodes[a.id],b)return a.iterate(function(b){return function(){return delete b.selected_nodes[a.id],!0}}(this))}else if(this.selected_single_node&&a.element===this.selected_single_node.element)return this.selected_single_node=null},a.prototype.addToSelection=function(a){return a.id?this.selected_nodes[a.id]=!0:this.selected_single_node=a},a}(),c=function(){function b(a){this.tree_widget=a,this.hovered_area=null,this.$ghost=null,this.hit_areas=[],this.is_dragging=!1,this.current_item=null}return b.prototype.mouseCapture=function(b){var c,d;return c=a(b.target),this.mustCaptureElement(c)?this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(c)?null:(d=this.tree_widget._getNodeElement(c),d&&this.tree_widget.options.onCanMove&&(this.tree_widget.options.onCanMove(d.node)||(d=null)),this.current_item=d,null!==this.current_item):null},b.prototype.mouseStart=function(b){var c;return this.refresh(),c=a(b.target).offset(),this.drag_element=new d(this.current_item.node,b.page_x-c.left,b.page_y-c.top,this.tree_widget.element),this.is_dragging=!0,this.current_item.$element.addClass("jqtree-moving"),!0
},b.prototype.mouseDrag=function(a){var b,c;return this.drag_element.move(a.page_x,a.page_y),b=this.findHoveredArea(a.page_x,a.page_y),c=this.canMoveToArea(b),c&&b?(b.node.isFolder()||this.stopOpenFolderTimer(),this.hovered_area!==b&&(this.hovered_area=b,this.mustOpenFolderTimer(b)?this.startOpenFolderTimer(b.node):this.stopOpenFolderTimer(),this.updateDropHint())):(this.removeHover(),this.removeDropHint(),this.stopOpenFolderTimer()),!0},b.prototype.mustCaptureElement=function(a){return!a.is("input,select")},b.prototype.canMoveToArea=function(a){var b;return a?this.tree_widget.options.onCanMoveTo?(b=n.getName(a.position),this.tree_widget.options.onCanMoveTo(this.current_item.node,a.node,b)):!0:!1},b.prototype.mouseStop=function(a){return this.moveItem(a),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas(),this.current_item&&(this.current_item.$element.removeClass("jqtree-moving"),this.current_item=null),this.is_dragging=!1,!1},b.prototype.refresh=function(){return this.removeHitAreas(),this.current_item&&(this.generateHitAreas(),this.current_item=this.tree_widget._getNodeElementForNode(this.current_item.node),this.is_dragging)?this.current_item.$element.addClass("jqtree-moving"):void 0},b.prototype.removeHitAreas=function(){return this.hit_areas=[]},b.prototype.clear=function(){return this.drag_element.remove(),this.drag_element=null},b.prototype.removeDropHint=function(){return this.previous_ghost?this.previous_ghost.remove():void 0},b.prototype.removeHover=function(){return this.hovered_area=null},b.prototype.generateHitAreas=function(){var a;return a=new h(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom),this.hit_areas=a.generate()},b.prototype.findHoveredArea=function(a,b){var c,d,e,f,g;if(d=this.getTreeDimensions(),a<d.left||b<d.top||a>d.right||b>d.bottom)return null;for(f=0,e=this.hit_areas.length;e>f;)if(g=f+e>>1,c=this.hit_areas[g],b<c.top)e=g;else{if(!(b>c.bottom))return c;f=g+1}return null},b.prototype.mustOpenFolderTimer=function(a){var b;return b=a.node,b.isFolder()&&!b.is_open&&a.position===n.INSIDE},b.prototype.updateDropHint=function(){var a;if(this.hovered_area)return this.removeDropHint(),a=this.tree_widget._getNodeElementForNode(this.hovered_area.node),this.previous_ghost=a.addDropHint(this.hovered_area.position)},b.prototype.startOpenFolderTimer=function(a){var b;return b=function(b){return function(){return b.tree_widget._openNode(a,b.tree_widget.options.slide,function(){return b.refresh(),b.updateDropHint()})}}(this),this.stopOpenFolderTimer(),this.open_folder_timer=setTimeout(b,this.tree_widget.options.openFolderDelay)},b.prototype.stopOpenFolderTimer=function(){return this.open_folder_timer?(clearTimeout(this.open_folder_timer),this.open_folder_timer=null):void 0},b.prototype.moveItem=function(a){var b,c,d,e,f,g;return this.hovered_area&&this.hovered_area.position!==n.NONE&&this.canMoveToArea(this.hovered_area)&&(d=this.current_item.node,g=this.hovered_area.node,e=this.hovered_area.position,f=d.parent,e===n.INSIDE&&(this.hovered_area.node.is_open=!0),b=function(a){return function(){return a.tree_widget.tree.moveNode(d,g,e),a.tree_widget.element.empty(),a.tree_widget._refreshElements()}}(this),c=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:d,target_node:g,position:n.getName(e),previous_parent:f,do_move:b,original_event:a.original_event}}),!c.isDefaultPrevented())?b():void 0},b.prototype.getTreeDimensions=function(){var a;return a=this.tree_widget.element.offset(),{left:a.left,top:a.top,right:a.left+this.tree_widget.element.width(),bottom:a.top+this.tree_widget.element.height()+16}},b}(),s=function(){function b(a){this.tree=a}return b.prototype.iterate=function(){var b,c;return b=!0,(c=function(d){return function(e,f){var g,h,i,j,k,l,m,n;if(k=(e.is_open||!e.element)&&e.hasChildren(),e.element){if(g=a(e.element),!g.is(":visible"))return;b&&(d.handleFirstNode(e,g),b=!1),e.hasChildren()?e.is_open?d.handleOpenFolder(e,g)||(k=!1):d.handleClosedFolder(e,f,g):d.handleNode(e,f,g)}if(k){for(i=e.children.length,n=e.children,j=l=0,m=n.length;m>l;j=++l)h=n[j],j===i-1?c(e.children[j],null):c(e.children[j],e.children[j+1]);if(e.is_open)return d.handleAfterOpenFolder(e,f,g)}}}(this))(this.tree,null)},b.prototype.handleNode=function(){},b.prototype.handleOpenFolder=function(){},b.prototype.handleClosedFolder=function(){},b.prototype.handleAfterOpenFolder=function(){},b.prototype.handleFirstNode=function(){},b}(),h=function(b){function c(a,b,d){c.__super__.constructor.call(this,a),this.current_node=b,this.tree_bottom=d}return B(c,b),c.prototype.generate=function(){return this.positions=[],this.last_top=0,this.iterate(),this.generateHitAreas(this.positions)},c.prototype.getTop=function(a){return a.offset().top},c.prototype.addPosition=function(a,b,c){var d;return d={top:c,node:a,position:b},this.positions.push(d),this.last_top=c},c.prototype.handleNode=function(a,b,c){var d;return d=this.getTop(c),a===this.current_node?this.addPosition(a,n.NONE,d):this.addPosition(a,n.INSIDE,d),b===this.current_node||a===this.current_node?this.addPosition(a,n.NONE,d):this.addPosition(a,n.AFTER,d)},c.prototype.handleOpenFolder=function(a,b){return a===this.current_node?!1:(a.children[0]!==this.current_node&&this.addPosition(a,n.INSIDE,this.getTop(b)),!0)},c.prototype.handleClosedFolder=function(a,b,c){var d;return d=this.getTop(c),a===this.current_node?this.addPosition(a,n.NONE,d):(this.addPosition(a,n.INSIDE,d),b!==this.current_node?this.addPosition(a,n.AFTER,d):void 0)},c.prototype.handleFirstNode=function(b){return b!==this.current_node?this.addPosition(b,n.BEFORE,this.getTop(a(b.element))):void 0},c.prototype.handleAfterOpenFolder=function(a,b){return a===this.current_node.node||b===this.current_node.node?this.addPosition(a,n.NONE,this.last_top):this.addPosition(a,n.AFTER,this.last_top)},c.prototype.generateHitAreas=function(a){var b,c,d,e,f,g;for(e=-1,b=[],c=[],f=0,g=a.length;g>f;f++)d=a[f],d.top!==e&&b.length&&(b.length&&this.generateHitAreasForGroup(c,b,e,d.top),e=d.top,b=[]),b.push(d);return this.generateHitAreasForGroup(c,b,e,this.tree_bottom),c},c.prototype.generateHitAreasForGroup=function(a,b,c,d){var e,f,g,h,i;for(i=Math.min(b.length,4),e=Math.round((d-c)/i),f=c,g=0;i>g;)h=b[g],a.push({top:f,bottom:f+e,node:h.node,position:h.position}),f+=e,g+=1;return null},c}(s),d=function(){function b(b,c,d,e){this.offset_x=c,this.offset_y=d,this.$element=a('<span class="jqtree-title jqtree-dragging">'+b.name+"</span>"),this.$element.css("position","absolute"),e.append(this.$element)}return b.prototype.move=function(a,b){return this.$element.offset({left:a-this.offset_x,top:b-this.offset_y})},b.prototype.remove=function(){return this.$element.remove()},b}(),g=function(){function b(b,c,d){this.$element=c,this.node=b,this.$ghost=a('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>'),d===n.AFTER?this.moveAfter():d===n.BEFORE?this.moveBefore():d===n.INSIDE&&(b.isFolder()&&b.is_open?this.moveInsideOpenFolder():this.moveInside())}return b.prototype.remove=function(){return this.$ghost.remove()},b.prototype.moveAfter=function(){return this.$element.after(this.$ghost)},b.prototype.moveBefore=function(){return this.$element.before(this.$ghost)},b.prototype.moveInsideOpenFolder=function(){return a(this.node.children[0].element).before(this.$ghost)},b.prototype.moveInside=function(){return this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")},b}(),b=function(){function b(b){var c,d;c=b.children(".jqtree-element"),d=b.width()-4,this.$hint=a('<span class="jqtree-border"></span>'),c.append(this.$hint),this.$hint.css({width:d,height:c.height()-4})}return b.prototype.remove=function(){return this.$hint.remove()},b}(),p=function(){function b(a){this.tree_widget=a,this.previous_top=-1,this._initScrollParent()}return b.prototype._initScrollParent=function(){var b,c,d;return c=function(b){return function(){var c,d,e,f,g,h;if(c=["overflow","overflow-y"],(e=function(b){var d,e,f,g;for(e=0,f=c.length;f>e;e++)if(d=c[e],"auto"===(g=a.css(b,d))||"scroll"===g)return!0;return!1})(b.tree_widget.$el[0]))return b.tree_widget.$el;for(h=b.tree_widget.$el.parents(),f=0,g=h.length;g>f;f++)if(d=h[f],e(d))return a(d);return null}}(this),d=function(a){return function(){return a.scroll_parent_top=0,a.$scroll_parent=null}}(this),"fixed"===this.tree_widget.$el.css("position")&&d(),b=c(),b&&b.length&&"HTML"!==b[0].tagName?(this.$scroll_parent=b,this.scroll_parent_top=this.$scroll_parent.offset().top):d()},b.prototype.checkScrolling=function(){var a;return a=this.tree_widget.dnd_handler.hovered_area,a&&a.top!==this.previous_top?(this.previous_top=a.top,this.$scroll_parent?this._handleScrollingWithScrollParent(a):this._handleScrollingWithDocument(a)):void 0},b.prototype._handleScrollingWithScrollParent=function(a){var b;return b=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-a.bottom,20>b?(this.$scroll_parent[0].scrollTop+=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):a.top-this.scroll_parent_top<20?(this.$scroll_parent[0].scrollTop-=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):void 0},b.prototype._handleScrollingWithDocument=function(b){var c;return c=b.top-a(document).scrollTop(),20>c?a(document).scrollTop(a(document).scrollTop()-20):a(window).height()-(b.bottom-a(document).scrollTop())<20?a(document).scrollTop(a(document).scrollTop()+20):void 0},b.prototype.scrollTo=function(b){var c;return this.$scroll_parent?this.$scroll_parent[0].scrollTop=b:(c=this.tree_widget.$el.offset().top,a(document).scrollTop(b+c))},b.prototype.isScrolledIntoView=function(b){var c,d,e,f,g;return c=a(b),this.$scroll_parent?(g=0,f=this.$scroll_parent.height(),e=c.offset().top-this.scroll_parent_top,d=e+c.height()):(g=a(window).scrollTop(),f=g+a(window).height(),e=c.offset().top,d=e+c.height()),f>=d&&e>=g},b}(),j=function(){function b(b){this.tree_widget=b,b.options.keyboardSupport&&a(document).bind("keydown.jqtree",a.proxy(this.handleKeyDown,this))}var c,d,e,f;return d=37,f=38,e=39,c=40,b.prototype.deinit=function(){return a(document).unbind("keydown.jqtree")},b.prototype.handleKeyDown=function(b){var g,h,i,j,k,l,m;if(this.tree_widget.options.keyboardSupport){if(a(document.activeElement).is("textarea,input,select"))return!0;if(g=this.tree_widget.getSelectedNode(),m=function(b){return function(c){return c?(b.tree_widget.selectNode(c),b.tree_widget.scroll_handler&&!b.tree_widget.scroll_handler.isScrolledIntoView(a(c.element).find(".jqtree-element"))&&b.tree_widget.scrollToNode(c),!1):!0}}(this),i=function(a){return function(){return m(a.getNextNode(g))}}(this),l=function(a){return function(){return m(a.getPreviousNode(g))}}(this),k=function(a){return function(){return g.isFolder()&&!g.is_open?(a.tree_widget.openNode(g),!1):!0}}(this),j=function(a){return function(){return g.isFolder()&&g.is_open?(a.tree_widget.closeNode(g),!1):!0}}(this),!g)return!0;switch(h=b.which){case c:return i();case f:return l();case e:return k();case d:return j()}}},b.prototype.getNextNode=function(a,b){var c;return null==b&&(b=!0),b&&a.hasChildren()&&a.is_open?a.children[0]:a.parent?(c=a.getNextSibling(),c?c:this.getNextNode(a.parent,!1)):null},b.prototype.getPreviousNode=function(a){var b;return a.parent?(b=a.getPreviousSibling(),b?b.hasChildren()&&b.is_open?this.getLastChild(b):b:a.parent.parent?a.parent:null):null},b.prototype.getLastChild=function(a){var b;return a.hasChildren()?(b=a.children[a.children.length-1],b.hasChildren()&&b.is_open?this.getLastChild(b):b):null},b}()}).call(this),function(a,b){function c(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)}function d(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return y[a.which]?y[a.which]:z[a.which]?z[a.which]:String.fromCharCode(a.which).toLowerCase()}function e(a,b){return a.sort().join(",")===b.sort().join(",")}function f(a){a=a||{};var b,c=!1;for(b in E)a[b]?c=!0:E[b]=0;c||(H=!1)}function g(a,b,c,d,f,g){var h,i,j=[],k=c.type;if(!C[a])return[];for("keyup"==k&&n(a)&&(b=[a]),h=0;h<C[a].length;++h)if(i=C[a][h],(d||!i.seq||E[i.seq]==i.level)&&k==i.action&&("keypress"==k&&!c.metaKey&&!c.ctrlKey||e(b,i.modifiers))){var l=!d&&i.combo==f,m=d&&i.seq==d&&i.level==g;(l||m)&&C[a].splice(h,1),j.push(i)}return j}function h(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function i(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)}function j(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)}function k(a,b,c,d){J.stopCallback(b,b.target||b.srcElement,c,d)||a(b,c)===!1&&(i(b),j(b))}function l(a,b,c){var d,e=g(a,b,c),h={},i=0,j=!1;for(d=0;d<e.length;++d)e[d].seq&&(i=Math.max(i,e[d].level));for(d=0;d<e.length;++d)if(e[d].seq){if(e[d].level!=i)continue;j=!0,h[e[d].seq]=1,k(e[d].callback,c,e[d].combo,e[d].seq)}else j||k(e[d].callback,c,e[d].combo);var l="keypress"==c.type&&G;c.type!=H||n(a)||l||f(h),G=j&&"keydown"==c.type}function m(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=d(a);if(b)return"keyup"==a.type&&F===b?void(F=!1):void J.handleKey(b,h(a),a)}function n(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function o(){clearTimeout(x),x=setTimeout(f,1e3)}function p(){if(!w){w={};for(var a in y)a>95&&112>a||y.hasOwnProperty(a)&&(w[y[a]]=a)}return w}function q(a,b,c){return c||(c=p()[a]?"keydown":"keypress"),"keypress"==c&&b.length&&(c="keydown"),c}function r(a,b,c,e){function g(b){return function(){H=b,++E[a],o()}}function h(b){k(c,b,a),"keyup"!==e&&(F=d(b)),setTimeout(f,10)}E[a]=0;for(var i=0;i<b.length;++i){var j=i+1===b.length,l=j?h:g(e||t(b[i+1]).action);u(b[i],l,e,a,i)}}function s(a){return"+"===a?["+"]:a.split("+")}function t(a,b){var c,d,e,f=[];for(c=s(a),e=0;e<c.length;++e)d=c[e],B[d]&&(d=B[d]),b&&"keypress"!=b&&A[d]&&(d=A[d],f.push("shift")),n(d)&&f.push(d);return b=q(d,f,b),{key:d,modifiers:f,action:b}}function u(a,b,c,d,e){D[a+":"+c]=b,a=a.replace(/\s+/g," ");var f,h=a.split(" ");return h.length>1?void r(a,h,b,c):(f=t(a,c),C[f.key]=C[f.key]||[],g(f.key,f.modifiers,{type:f.action},d,a,e),void C[f.key][d?"unshift":"push"]({callback:b,modifiers:f.modifiers,action:f.action,seq:d,level:e,combo:a}))}function v(a,b,c){for(var d=0;d<a.length;++d)u(a[d],b,c)}for(var w,x,y={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},z={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},A={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},B={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},C={},D={},E={},F=!1,G=!1,H=!1,I=1;20>I;++I)y[111+I]="f"+I;for(I=0;9>=I;++I)y[I+96]=I;c(b,"keypress",m),c(b,"keydown",m),c(b,"keyup",m);var J={bind:function(a,b,c){return a=a instanceof Array?a:[a],v(a,b,c),this},unbind:function(a,b){return J.bind(a,function(){},b)},trigger:function(a,b){return D[a+":"+b]&&D[a+":"+b]({},a),this},reset:function(){return C={},D={},this},stopCallback:function(a,b){return(" "+b.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:l};a.Mousetrap=J,"function"==typeof define&&define.amd&&define(J)}(window,document);var CanvasImage=function(a){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=a.width,this.height=this.canvas.height=a.height,this.context.drawImage(a,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(a){this.context.putImageData(a,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(a,b){var c=this.getPalette(a,5,b),d=c[0];return d},ColorThief.prototype.getPalette=function(a,b,c){"undefined"==typeof b&&(b=10),"undefined"==typeof c&&(c=10);for(var d,e,f,g,h,i=new CanvasImage(a),j=i.getImageData(),k=j.data,l=i.getPixelCount(),m=[],n=0;l>n;n+=c)d=4*n,e=k[d+0],f=k[d+1],g=k[d+2],h=k[d+3],h>=125&&(e>250&&f>250&&g>250||m.push([e,f,g]));var o=MMCQ.quantize(m,b),p=o.palette();return i.removeCanvas(),p},!pv)var pv={map:function(a,b){var c={};return b?a.map(function(a,d){return c.index=d,b.call(c,a)}):a.slice()},naturalOrder:function(a,b){return b>a?-1:a>b?1:0},sum:function(a,b){var c={};return a.reduce(b?function(a,d,e){return c.index=e,a+b.call(c,d)}:function(a,b){return a+b},0)},max:function(a,b){return Math.max.apply(null,b?pv.map(a,b):a)}};var MMCQ=function(){function a(a,b,c){return(a<<2*i)+(b<<i)+c}function b(a){function b(){c.sort(a),d=!0}var c=[],d=!1;return{push:function(a){c.push(a),d=!1},peek:function(a){return d||b(),void 0===a&&(a=c.length-1),c[a]},pop:function(){return d||b(),c.pop()},size:function(){return c.length},map:function(a){return c.map(a)},debug:function(){return d||b(),c}}}function c(a,b,c,d,e,f,g){var h=this;h.r1=a,h.r2=b,h.g1=c,h.g2=d,h.b1=e,h.b2=f,h.histo=g}function d(){this.vboxes=new b(function(a,b){return pv.naturalOrder(a.vbox.count()*a.vbox.volume(),b.vbox.count()*b.vbox.volume())})}function e(b){var c,d,e,f,g=1<<3*i,h=new Array(g);return b.forEach(function(b){d=b[0]>>j,e=b[1]>>j,f=b[2]>>j,c=a(d,e,f),h[c]=(h[c]||0)+1}),h}function f(a,b){var d,e,f,g=1e6,h=0,i=1e6,k=0,l=1e6,m=0;return a.forEach(function(a){d=a[0]>>j,e=a[1]>>j,f=a[2]>>j,g>d?g=d:d>h&&(h=d),i>e?i=e:e>k&&(k=e),l>f?l=f:f>m&&(m=f)}),new c(g,h,i,k,l,m,b)}function g(b,c){function d(a){var b,d,e,f,g,h=a+"1",j=a+"2",k=0;for(i=c[h];i<=c[j];i++)if(o[i]>n/2){for(e=c.copy(),f=c.copy(),b=i-c[h],d=c[j]-i,g=d>=b?Math.min(c[j]-1,~~(i+d/2)):Math.max(c[h],~~(i-1-b/2));!o[g];)g++;for(k=p[g];!k&&o[g-1];)k=p[--g];return e[j]=g,f[h]=e[j]+1,[e,f]}}if(c.count()){var e=c.r2-c.r1+1,f=c.g2-c.g1+1,g=c.b2-c.b1+1,h=pv.max([e,f,g]);if(1==c.count())return[c.copy()];var i,j,k,l,m,n=0,o=[],p=[];if(h==e)for(i=c.r1;i<=c.r2;i++){for(l=0,j=c.g1;j<=c.g2;j++)for(k=c.b1;k<=c.b2;k++)m=a(i,j,k),l+=b[m]||0;n+=l,o[i]=n}else if(h==f)for(i=c.g1;i<=c.g2;i++){for(l=0,j=c.r1;j<=c.r2;j++)for(k=c.b1;k<=c.b2;k++)m=a(j,i,k),l+=b[m]||0;n+=l,o[i]=n}else for(i=c.b1;i<=c.b2;i++){for(l=0,j=c.r1;j<=c.r2;j++)for(k=c.g1;k<=c.g2;k++)m=a(j,k,i),l+=b[m]||0;n+=l,o[i]=n}return o.forEach(function(a,b){p[b]=n-a}),d(h==e?"r":h==f?"g":"b")}}function h(a,c){function h(a,b){for(var c,d=1,e=0;k>e;)if(c=a.pop(),c.count()){var f=g(i,c),h=f[0],j=f[1];if(!h)return;if(a.push(h),j&&(a.push(j),d++),d>=b)return;if(e++>k)return}else a.push(c),e++}if(!a.length||2>c||c>256)return!1;var i=e(a),j=0;i.forEach(function(){j++});var m=f(a,i),n=new b(function(a,b){return pv.naturalOrder(a.count(),b.count())});n.push(m),h(n,l*c);for(var o=new b(function(a,b){return pv.naturalOrder(a.count()*a.volume(),b.count()*b.volume())});n.size();)o.push(n.pop());h(o,c-o.size());for(var p=new d;o.size();)p.push(o.pop());return p}var i=5,j=8-i,k=1e3,l=.75;return c.prototype={volume:function(a){var b=this;return(!b._volume||a)&&(b._volume=(b.r2-b.r1+1)*(b.g2-b.g1+1)*(b.b2-b.b1+1)),b._volume},count:function(b){var c=this,d=c.histo;if(!c._count_set||b){var e,f,g,h=0;for(e=c.r1;e<=c.r2;e++)for(f=c.g1;f<=c.g2;f++)for(g=c.b1;g<=c.b2;g++)index=a(e,f,g),h+=d[index]||0;c._count=h,c._count_set=!0}return c._count},copy:function(){var a=this;return new c(a.r1,a.r2,a.g1,a.g2,a.b1,a.b2,a.histo)},avg:function(b){var c=this,d=c.histo;if(!c._avg||b){var e,f,g,h,j,k=0,l=1<<8-i,m=0,n=0,o=0;for(f=c.r1;f<=c.r2;f++)for(g=c.g1;g<=c.g2;g++)for(h=c.b1;h<=c.b2;h++)j=a(f,g,h),e=d[j]||0,k+=e,m+=e*(f+.5)*l,n+=e*(g+.5)*l,o+=e*(h+.5)*l;c._avg=k?[~~(m/k),~~(n/k),~~(o/k)]:[~~(l*(c.r1+c.r2+1)/2),~~(l*(c.g1+c.g2+1)/2),~~(l*(c.b1+c.b2+1)/2)]}return c._avg},contains:function(a){var b=this,c=a[0]>>j;return gval=a[1]>>j,bval=a[2]>>j,c>=b.r1&&c<=b.r2&&gval>=b.g1&&gval<=b.g2&&bval>=b.b1&&bval<=b.b2}},d.prototype={push:function(a){this.vboxes.push({vbox:a,color:a.avg()})},palette:function(){return this.vboxes.map(function(a){return a.color})},size:function(){return this.vboxes.size()},map:function(a){for(var b=this.vboxes,c=0;c<b.size();c++)if(b.peek(c).vbox.contains(a))return b.peek(c).color;return this.nearest(a)},nearest:function(a){for(var b,c,d,e=this.vboxes,f=0;f<e.size();f++)c=Math.sqrt(Math.pow(a[0]-e.peek(f).color[0],2)+Math.pow(a[1]-e.peek(f).color[1],2)+Math.pow(a[2]-e.peek(f).color[2],2)),(b>c||void 0===b)&&(b=c,d=e.peek(f).color);return d},forcebw:function(){var a=this.vboxes;a.sort(function(a,b){return pv.naturalOrder(pv.sum(a.color),pv.sum(b.color))});var b=a[0].color;b[0]<5&&b[1]<5&&b[2]<5&&(a[0].color=[0,0,0]);var c=a.length-1,d=a[c].color;d[0]>251&&d[1]>251&&d[2]>251&&(a[c].color=[255,255,255])}},{quantize:h}}();!function(a,b){"use strict";"object"==typeof exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)}(this,function(a,b,c,d){"use strict";function e(a,b){return this instanceof e?(void 0===a&&(a="undefined"!=typeof location?location.href+"":""),this.href(a),void 0!==b?this.absoluteTo(b):this):new e(a,b)}function f(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function g(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function h(a){return"Array"===g(a)}function i(a,b){var c,d,e={};if(h(b))for(c=0,d=b.length;d>c;c++)e[b[c]]=!0;else e[b]=!0;for(c=0,d=a.length;d>c;c++)void 0!==e[a[c]]&&(a.splice(c,1),d--,c--);return a}function j(a,b){var c,d;if(h(b)){for(c=0,d=b.length;d>c;c++)if(!j(a,b[c]))return!1;return!0}var e=g(b);for(c=0,d=a.length;d>c;c++)if("RegExp"===e){if("string"==typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function k(a,b){if(!h(a)||!h(b))return!1;if(a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,d=a.length;d>c;c++)if(a[c]!==b[c])return!1;return!0}function l(a){return escape(a)}function m(a){return encodeURIComponent(a).replace(/[!'()*]/g,l).replace(/\*/g,"%2A")}function n(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function o(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}}var p=d&&d.URI;e.version="1.14.1";var q=e.prototype,r=Object.prototype.hasOwnProperty;e._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:e.duplicateQueryParameters,escapeQuerySpace:e.escapeQuerySpace}},e.duplicateQueryParameters=!1,e.escapeQuerySpace=!0,e.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,e.idn_expression=/[^a-z0-9\.-]/i,e.punycode_expression=/(xn--)/i,e.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,e.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,e.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,e.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},e.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},e.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,e.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},e.getDomAttribute=function(a){if(!a||!a.nodeName)return void 0;var b=a.nodeName.toLowerCase();return"input"===b&&"image"!==a.type?void 0:e.domAttributes[b]},e.encode=m,e.decode=decodeURIComponent,e.iso8859=function(){e.encode=escape,e.decode=unescape},e.unicode=function(){e.encode=m,e.decode=decodeURIComponent},e.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},e.encodeQuery=function(a,b){var c=e.encode(a+"");return void 0===b&&(b=e.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},e.decodeQuery=function(a,b){a+="",void 0===b&&(b=e.escapeQuerySpace);try{return e.decode(b?a.replace(/\+/g,"%20"):a)}catch(c){return a}},e.recodePath=function(a){for(var b=(a+"").split("/"),c=0,d=b.length;d>c;c++)b[c]=e.encodePathSegment(e.decode(b[c]));return b.join("/")},e.decodePath=function(a){for(var b=(a+"").split("/"),c=0,d=b.length;d>c;c++)b[c]=e.decodePathSegment(b[c]);return b.join("/")};var s,t={encode:"encode",decode:"decode"},u=function(a,b){return function(c){try{return e[b](c+"").replace(e.characters[a][b].expression,function(c){return e.characters[a][b].map[c]})}catch(d){return c}}};for(s in t)e[s+"PathSegment"]=u("pathname",t[s]);e.encodeReserved=u("reserved","encode"),e.parse=function(a,b){var c;return b||(b={}),c=a.indexOf("#"),c>-1&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),c=a.indexOf("?"),c>-1&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=e.parseAuthority(a,b)):(c=a.indexOf(":"),c>-1&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(e.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=e.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0))),b.path=a,b},e.parseHost=function(a,b){var c,d,e=a.indexOf("/");return-1===e&&(e=a.length),"["===a.charAt(0)?(c=a.indexOf("]"),b.hostname=a.substring(1,c)||null,b.port=a.substring(c+2,e)||null,"/"===b.port&&(b.port=null)):a.indexOf(":")!==a.lastIndexOf(":")?(b.hostname=a.substring(0,e)||null,b.port=null):(d=a.substring(0,e).split(":"),b.hostname=d[0]||null,b.port=d[1]||null),b.hostname&&"/"!==a.substring(e).charAt(0)&&(e++,a="/"+a),a.substring(e)||"/"},e.parseAuthority=function(a,b){return a=e.parseUserinfo(a,b),e.parseHost(a,b)},e.parseUserinfo=function(a,b){var c,d=a.indexOf("/"),f=a.lastIndexOf("@",d>-1?d:a.length-1);return f>-1&&(-1===d||d>f)?(c=a.substring(0,f).split(":"),b.username=c[0]?e.decode(c[0]):null,c.shift(),b.password=c[0]?e.decode(c.join(":")):null,a=a.substring(f+1)):(b.username=null,b.password=null),a},e.parseQuery=function(a,b){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var c,d,f,g={},h=a.split("&"),i=h.length,j=0;i>j;j++)c=h[j].split("="),d=e.decodeQuery(c.shift(),b),f=c.length?e.decodeQuery(c.join("="),b):null,r.call(g,d)?("string"==typeof g[d]&&(g[d]=[g[d]]),g[d].push(f)):g[d]=f;return g},e.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//"),b+=e.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},e.buildHost=function(a){var b="";return a.hostname?(b+=e.ip6_expression.test(a.hostname)?"["+a.hostname+"]":a.hostname,a.port&&(b+=":"+a.port),b):""},e.buildAuthority=function(a){return e.buildUserinfo(a)+e.buildHost(a)},e.buildUserinfo=function(a){var b="";return a.username&&(b+=e.encode(a.username),a.password&&(b+=":"+e.encode(a.password)),b+="@"),b},e.buildQuery=function(a,b,c){var d,f,g,i,j="";for(f in a)if(r.call(a,f)&&f)if(h(a[f]))for(d={},g=0,i=a[f].length;i>g;g++)void 0!==a[f][g]&&void 0===d[a[f][g]+""]&&(j+="&"+e.buildQueryParameter(f,a[f][g],c),b!==!0&&(d[a[f][g]+""]=!0));else void 0!==a[f]&&(j+="&"+e.buildQueryParameter(f,a[f],c));return j.substring(1)},e.buildQueryParameter=function(a,b,c){return e.encodeQuery(a,c)+(null!==b?"="+e.encodeQuery(b,c):"")},e.addQuery=function(a,b,c){if("object"==typeof b)for(var d in b)r.call(b,d)&&e.addQuery(a,d,b[d]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===a[b])return void(a[b]=c);"string"==typeof a[b]&&(a[b]=[a[b]]),h(c)||(c=[c]),a[b]=(a[b]||[]).concat(c)}},e.removeQuery=function(a,b,c){var d,f,g;if(h(b))for(d=0,f=b.length;f>d;d++)a[b[d]]=void 0;else if("object"==typeof b)for(g in b)r.call(b,g)&&e.removeQuery(a,g,b[g]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");void 0!==c?a[b]===c?a[b]=void 0:h(a[b])&&(a[b]=i(a[b],c)):a[b]=void 0}},e.hasQuery=function(a,b,c,d){if("object"==typeof b){for(var f in b)if(r.call(b,f)&&!e.hasQuery(a,f,b[f]))return!1;return!0}if("string"!=typeof b)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(g(c)){case"Undefined":return b in a;case"Boolean":var i=Boolean(h(a[b])?a[b].length:a[b]);return c===i;case"Function":return!!c(a[b],b,a);case"Array":if(!h(a[b]))return!1;var l=d?j:k;return l(a[b],c);case"RegExp":return h(a[b])?d?j(a[b],c):!1:Boolean(a[b]&&a[b].match(c));case"Number":c=String(c);case"String":return h(a[b])?d?j(a[b],c):!1:a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},e.commonPath=function(a,b){var c,d=Math.min(a.length,b.length);for(c=0;d>c;c++)if(a.charAt(c)!==b.charAt(c)){c--;break}return 1>c?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":(("/"!==a.charAt(c)||"/"!==b.charAt(c))&&(c=a.substring(0,c).lastIndexOf("/")),a.substring(0,c+1))},e.withinString=function(a,b,c){c||(c={});var d=c.start||e.findUri.start,f=c.end||e.findUri.end,g=c.trim||e.findUri.trim,h=/[a-z0-9-]=["']?$/i;for(d.lastIndex=0;;){var i=d.exec(a);if(!i)break;var j=i.index;if(c.ignoreHtml){var k=a.slice(Math.max(j-3,0),j);if(k&&h.test(k))continue}var l=j+a.slice(j).search(f),m=a.slice(j,l).replace(g,"");if(!c.ignore||!c.ignore.test(m)){l=j+m.length;var n=b(m,j,l,a);a=a.slice(0,j)+n+a.slice(l),d.lastIndex=j+n.length}}return d.lastIndex=0,a},e.ensureValidHostname=function(b){if(b.match(e.invalid_hostname_characters)){if(!a)throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');
if(a.toASCII(b).match(e.invalid_hostname_characters))throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-]')}},e.noConflict=function(a){if(a){var b={URI:this.noConflict()};return d.URITemplate&&"function"==typeof d.URITemplate.noConflict&&(b.URITemplate=d.URITemplate.noConflict()),d.IPv6&&"function"==typeof d.IPv6.noConflict&&(b.IPv6=d.IPv6.noConflict()),d.SecondLevelDomains&&"function"==typeof d.SecondLevelDomains.noConflict&&(b.SecondLevelDomains=d.SecondLevelDomains.noConflict()),b}return d.URI===this&&(d.URI=p),this},q.build=function(a){return a===!0?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=e.build(this._parts),this._deferred_build=!1),this},q.clone=function(){return new e(this)},q.valueOf=q.toString=function(){return this.build(!1)._string},q.protocol=n("protocol"),q.username=n("username"),q.password=n("password"),q.hostname=n("hostname"),q.port=n("port"),q.query=o("query","?"),q.fragment=o("fragment","#"),q.search=function(a,b){var c=this.query(a,b);return"string"==typeof c&&c.length?"?"+c:c},q.hash=function(a,b){var c=this.fragment(a,b);return"string"==typeof c&&c.length?"#"+c:c},q.pathname=function(a,b){if(void 0===a||a===!0){var c=this._parts.path||(this._parts.hostname?"/":"");return a?e.decodePath(c):c}return this._parts.path=a?e.recodePath(a):"/",this.build(!b),this},q.path=q.pathname,q.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="",this._parts=e._parts();var d=a instanceof e,f="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName){var g=e.getDomAttribute(a);a=a[g]||"",f=!1}if(!d&&f&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a||a instanceof String)this._parts=e.parse(String(a),this._parts);else{if(!d&&!f)throw new TypeError("invalid input");var h=d?a._parts:a;for(c in h)r.call(this._parts,c)&&(this._parts[c]=h[c])}return this.build(!b),this},q.is=function(a){var b=!1,d=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,d=e.ip4_expression.test(this._parts.hostname),f=e.ip6_expression.test(this._parts.hostname),b=d||f,g=!b,h=g&&c&&c.has(this._parts.hostname),i=g&&e.idn_expression.test(this._parts.hostname),j=g&&e.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return g;case"sld":return h;case"ip":return b;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return f;case"idn":return i;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return j}return null};var v=q.protocol,w=q.port,x=q.hostname;q.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(e.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return v.call(this,a,b)},q.scheme=q.protocol,q.port=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),a.match(/[^0-9]/))))throw new TypeError('Port "'+a+'" contains characters other than [0-9]');return w.call(this,a,b)},q.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={};e.parseHost(a,c),a=c.hostname}return x.call(this,a,b)},q.host=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?e.buildHost(this._parts):"":(e.parseHost(a,this._parts),this.build(!b),this)},q.authority=function(a,b){return this._parts.urn?void 0===a?"":this:void 0===a?this._parts.hostname?e.buildAuthority(this._parts):"":(e.parseAuthority(a,this._parts),this.build(!b),this)},q.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.username)return"";var c=e.buildUserinfo(this._parts);return c.substring(0,c.length-1)}return"@"!==a[a.length-1]&&(a+="@"),e.parseUserinfo(a,this._parts),this.build(!b),this},q.resource=function(a,b){var c;return void 0===a?this.path()+this.search()+this.hash():(c=e.parse(a),this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this)},q.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}var d=this._parts.hostname.length-this.domain().length,g=this._parts.hostname.substring(0,d),h=new RegExp("^"+f(g));return a&&"."!==a.charAt(a.length-1)&&(a+="."),a&&e.ensureValidHostname(a),this._parts.hostname=this._parts.hostname.replace(h,a),this.build(!b),this},q.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);if(c&&c.length<2)return this._parts.hostname;var d=this._parts.hostname.length-this.tld(b).length-1;return d=this._parts.hostname.lastIndexOf(".",d-1)+1,this._parts.hostname.substring(d)||""}if(!a)throw new TypeError("cannot set domain empty");if(e.ensureValidHostname(a),!this._parts.hostname||this.is("IP"))this._parts.hostname=a;else{var g=new RegExp(f(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(g,a)}return this.build(!b),this},q.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.lastIndexOf("."),e=this._parts.hostname.substring(d+1);return b!==!0&&c&&c.list[e.toLowerCase()]?c.get(this._parts.hostname)||e:e}var g;if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!c||!c.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');g=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");g=new RegExp(f(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(g,a)}return this.build(!b),this},q.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,d=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?e.decodePath(d):d}var g=this._parts.path.length-this.filename().length,h=this._parts.path.substring(0,g),i=new RegExp("^"+f(h));return this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a),this.build(!b),this},q.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),d=this._parts.path.substring(c+1);return a?e.decodePathSegment(d):d}var g=!1;"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(g=!0);var h=new RegExp(f(this.filename())+"$");return a=e.recodePath(a),this._parts.path=this._parts.path.replace(h,a),g?this.normalizePath(b):this.build(!b),this},q.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c,d,g=this.filename(),h=g.lastIndexOf(".");return-1===h?"":(c=g.substring(h+1),d=/^[a-z0-9%]+$/i.test(c)?c:"",a?e.decodePathSegment(d):d)}"."===a.charAt(0)&&(a=a.substring(1));var i,j=this.suffix();if(j)i=new RegExp(a?f(j)+"$":f("."+j)+"$");else{if(!a)return this;this._parts.path+="."+e.recodePath(a)}return i&&(a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a)),this.build(!b),this},q.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),f="/"===e.substring(0,1),g=e.split(d);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw new Error('Bad segment "'+a+'", must be 0-based integer');if(f&&g.shift(),0>a&&(a=Math.max(g.length+a,0)),void 0===b)return void 0===a?g:g[a];if(null===a||void 0===g[a])if(h(b)){g=[];for(var i=0,j=b.length;j>i;i++)(b[i].length||g.length&&g[g.length-1].length)&&(g.length&&!g[g.length-1].length&&g.pop(),g.push(b[i]))}else(b||"string"==typeof b)&&(""===g[g.length-1]?g[g.length-1]=b:g.push(b));else b?g[a]=b:g.splice(a,1);return f&&g.unshift(""),this.path(g.join(d),c)},q.segmentCoded=function(a,b,c){var d,f,g;if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(d=this.segment(a,b,c),h(d))for(f=0,g=d.length;g>f;f++)d[f]=e.decode(d[f]);else d=void 0!==d?e.decode(d):void 0;return d}if(h(b))for(f=0,g=b.length;g>f;f++)b[f]=e.decode(b[f]);else b="string"==typeof b||b instanceof String?e.encode(b):b;return this.segment(a,b,c)};var y=q.query;return q.query=function(a,b){if(a===!0)return e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var c=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace),d=a.call(this,c);return this._parts.query=e.buildQuery(d||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=e.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):y.call(this,a,b)},q.setQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)d[a]=void 0!==b?b:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var f in a)r.call(a,f)&&(d[f]=a[f])}return this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},q.addQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.addQuery(d,a,void 0===b?null:b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},q.removeQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.removeQuery(d,a,b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},q.hasQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.hasQuery(d,a,b,c)},q.setSearch=q.setQuery,q.addSearch=q.addQuery,q.removeSearch=q.removeQuery,q.hasSearch=q.hasQuery,q.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},q.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},q.normalizeHostname=function(c){return this._parts.hostname&&(this.is("IDN")&&a?this._parts.hostname=a.toASCII(this._parts.hostname):this.is("IPv6")&&b&&(this._parts.hostname=b.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!c)),this},q.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===e.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},q.normalizePath=function(a){if(this._parts.urn)return this;if(!this._parts.path||"/"===this._parts.path)return this;var b,c,d,f=this._parts.path,g="";for("/"!==f.charAt(0)&&(b=!0,f="/"+f),f=f.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),b&&(g=f.substring(1).match(/^(\.\.\/)+/)||"",g&&(g=g[0]));;){if(c=f.indexOf("/.."),-1===c)break;0!==c?(d=f.substring(0,c).lastIndexOf("/"),-1===d&&(d=c),f=f.substring(0,d)+f.substring(c+3)):f=f.substring(3)}return b&&this.is("relative")&&(f=g+f.substring(1)),f=e.recodePath(f),this._parts.path=f,this.build(!a),this},q.normalizePathname=q.normalizePath,q.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(e.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},q.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},q.normalizeSearch=q.normalizeQuery,q.normalizeHash=q.normalizeFragment,q.iso8859=function(){var a=e.encode,b=e.decode;return e.encode=escape,e.decode=decodeURIComponent,this.normalize(),e.encode=a,e.decode=b,this},q.unicode=function(){var a=e.encode,b=e.decode;return e.encode=m,e.decode=unescape,this.normalize(),e.encode=a,e.decode=b,this},q.readable=function(){var b=this.clone();b.username("").password("").normalize();var c="";if(b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&a?(c+=a.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path.charAt(0)&&(c+="/"),c+=b.path(!0),b._parts.query){for(var d="",f=0,g=b._parts.query.split("&"),h=g.length;h>f;f++){var i=(g[f]||"").split("=");d+="&"+e.decodeQuery(i[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==i[1]&&(d+="="+e.decodeQuery(i[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=e.decodeQuery(b.hash(),!0)},q.absoluteTo=function(a){var b,c,d,f=this.clone(),g=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a instanceof e||(a=new e(a)),f._parts.protocol||(f._parts.protocol=a._parts.protocol),this._parts.hostname)return f;for(c=0;d=g[c];c++)f._parts[d]=a._parts[d];return f._parts.path?".."===f._parts.path.substring(-2)&&(f._parts.path+="/"):(f._parts.path=a._parts.path,f._parts.query||(f._parts.query=a._parts.query)),"/"!==f.path().charAt(0)&&(b=a.directory(),f._parts.path=(b?b+"/":"")+f._parts.path,f.normalizePath()),f.build(),f},q.relativeTo=function(a){var b,c,d,f,g,h=this.clone().normalize();if(h._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a=new e(a).normalize(),b=h._parts,c=a._parts,f=h.path(),g=a.path(),"/"!==f.charAt(0))throw new Error("URI is already relative");if("/"!==g.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(b.protocol===c.protocol&&(b.protocol=null),b.username!==c.username||b.password!==c.password)return h.build();if(null!==b.protocol||null!==b.username||null!==b.password)return h.build();if(b.hostname!==c.hostname||b.port!==c.port)return h.build();if(b.hostname=null,b.port=null,f===g)return b.path="",h.build();if(d=e.commonPath(h.path(),a.path()),!d)return h.build();var i=c.path.substring(d.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return b.path=i+b.path.substring(d.length),h.build()},q.equals=function(a){var b,c,d,f=this.clone(),g=new e(a),i={},j={},l={};if(f.normalize(),g.normalize(),f.toString()===g.toString())return!0;if(b=f.query(),c=g.query(),f.query(""),g.query(""),f.toString()!==g.toString())return!1;if(b.length!==c.length)return!1;i=e.parseQuery(b,this._parts.escapeQuerySpace),j=e.parseQuery(c,this._parts.escapeQuerySpace);for(d in i)if(r.call(i,d)){if(h(i[d])){if(!k(i[d],j[d]))return!1}else if(i[d]!==j[d])return!1;l[d]=!0}for(d in j)if(r.call(j,d)&&!l[d])return!1;return!0},q.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},q.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},e}),function(){var a;a=function(a){var b,c;return b=!1,a(function(){var d;return d=(document.body||document.documentElement).style,b=void 0!==d.animation||void 0!==d.WebkitAnimation||void 0!==d.MozAnimation||void 0!==d.MsAnimation||void 0!==d.OAnimation,a(window).bind("keyup.vex",function(a){return 27===a.keyCode?c.closeByEscape():void 0})}),c={globalID:1,animationEndEvent:"animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",baseClassNames:{vex:"vex",content:"vex-content",overlay:"vex-overlay",close:"vex-close",closing:"vex-closing",open:"vex-open"},defaultOptions:{content:"",showCloseButton:!0,escapeButtonCloses:!0,overlayClosesOnClick:!0,appendLocation:"body",className:"",css:{},overlayClassName:"",overlayCSS:{},contentClassName:"",contentCSS:{},closeClassName:"",closeCSS:{}},open:function(b){return b=a.extend({},c.defaultOptions,b),b.id=c.globalID,c.globalID+=1,b.$vex=a("<div>").addClass(c.baseClassNames.vex).addClass(b.className).css(b.css).data({vex:b}),b.$vexOverlay=a("<div>").addClass(c.baseClassNames.overlay).addClass(b.overlayClassName).css(b.overlayCSS).data({vex:b}),b.overlayClosesOnClick&&b.$vexOverlay.bind("click.vex",function(b){return b.target===this?c.close(a(this).data().vex.id):void 0}),b.$vex.append(b.$vexOverlay),b.$vexContent=a("<div>").addClass(c.baseClassNames.content).addClass(b.contentClassName).css(b.contentCSS).append(b.content).data({vex:b}),b.$vex.append(b.$vexContent),b.showCloseButton&&(b.$closeButton=a("<div>").addClass(c.baseClassNames.close).addClass(b.closeClassName).css(b.closeCSS).data({vex:b}).bind("click.vex",function(){return c.close(a(this).data().vex.id)}),b.$vexContent.append(b.$closeButton)),a(b.appendLocation).append(b.$vex),c.setupBodyClassName(b.$vex),b.afterOpen&&b.afterOpen(b.$vexContent,b),setTimeout(function(){return b.$vexContent.trigger("vexOpen",b)},0),b.$vexContent},getAllVexes:function(){return a("."+c.baseClassNames.vex+':not(".'+c.baseClassNames.closing+'") .'+c.baseClassNames.content)},getVexByID:function(b){return c.getAllVexes().filter(function(){return a(this).data().vex.id===b})},close:function(a){var b;if(!a){if(b=c.getAllVexes().last(),!b.length)return!1;a=b.data().vex.id}return c.closeByID(a)},closeAll:function(){var b;return b=c.getAllVexes().map(function(){return a(this).data().vex.id}).toArray(),(null!=b?b.length:void 0)?(a.each(b.reverse(),function(a,b){return c.closeByID(b)}),!0):!1},closeByID:function(d){var e,f,g,h,i;return f=c.getVexByID(d),f.length?(e=f.data().vex.$vex,i=a.extend({},f.data().vex),g=function(){return i.beforeClose?i.beforeClose(f,i):void 0},h=function(){return f.trigger("vexClose",i),e.remove(),a("body").trigger("vexAfterClose",i),i.afterClose?i.afterClose(f,i):void 0},b?(g(),e.unbind(c.animationEndEvent).bind(c.animationEndEvent,function(){return h()}).addClass(c.baseClassNames.closing)):(g(),h()),!0):void 0},closeByEscape:function(){var b,d,e;return e=c.getAllVexes().map(function(){return a(this).data().vex.id}).toArray(),(null!=e?e.length:void 0)?(d=Math.max.apply(Math,e),b=c.getVexByID(d),b.data().vex.escapeButtonCloses!==!0?!1:c.closeByID(d)):!1},setupBodyClassName:function(){return a("body").bind("vexOpen.vex",function(){return a("body").addClass(c.baseClassNames.open)}).bind("vexAfterClose.vex",function(){return c.getAllVexes().length?void 0:a("body").removeClass(c.baseClassNames.open)})},hideLoading:function(){return a(".vex-loading-spinner").remove()},showLoading:function(){return c.hideLoading(),a("body").append('<div class="vex-loading-spinner '+c.defaultOptions.className+'"></div>')}}},"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a(require("jquery")):window.vex=a(jQuery)}.call(this),function(){var a;a=function(a,b){var c,d;return null==b?a.error("Vex is required to use vex.dialog"):(c=function(b){var c;return c={},a.each(b.serializeArray(),function(){return c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c},d={},d.buttons={YES:{text:"OK",type:"submit",className:"vex-dialog-button-primary"},NO:{text:"Cancel",type:"button",className:"vex-dialog-button-secondary",click:function(a){return a.data().vex.value=!1,b.close(a.data().vex.id)}}},d.defaultOptions={callback:function(){},afterOpen:function(){},message:"Message",input:'<input name="vex" type="hidden" value="_vex-empty-value" />',value:!1,buttons:[d.buttons.YES,d.buttons.NO],showCloseButton:!1,onSubmit:function(e){var f,g;return f=a(this),g=f.parent(),e.preventDefault(),e.stopPropagation(),g.data().vex.value=d.getFormValueOnSubmit(c(f)),b.close(g.data().vex.id)},focusFirstInput:!0},d.defaultAlertOptions={message:"Alert",buttons:[d.buttons.YES]},d.defaultConfirmOptions={message:"Confirm"},d.open=function(c){var e;return c=a.extend({},b.defaultOptions,d.defaultOptions,c),c.content=d.buildDialogForm(c),c.beforeClose=function(a){return c.callback(a.data().vex.value)},e=b.open(c),c.focusFirstInput&&e.find('input[type="submit"], textarea, input[type="date"], input[type="datetime"], input[type="datetime-local"], input[type="email"], input[type="month"], input[type="number"], input[type="password"], input[type="search"], input[type="tel"], input[type="text"], input[type="time"], input[type="url"], input[type="week"]').first().focus(),e},d.alert=function(b){return"string"==typeof b&&(b={message:b}),b=a.extend({},d.defaultAlertOptions,b),d.open(b)},d.confirm=function(b){return"string"==typeof b?a.error("dialog.confirm(options) requires options.callback."):(b=a.extend({},d.defaultConfirmOptions,b),d.open(b))},d.prompt=function(b){var c;return"string"==typeof b?a.error("dialog.prompt(options) requires options.callback."):(c={message:'<label for="vex">'+(b.label||"Prompt:")+"</label>",input:'<input name="vex" type="text" class="vex-dialog-prompt-input" placeholder="'+(b.placeholder||"")+'"  value="'+(b.value||"")+'" />'},b=a.extend({},c,b),d.open(b))},d.buildDialogForm=function(b){var c,e,f;return c=a('<form class="vex-dialog-form" />'),f=a('<div class="vex-dialog-message" />'),e=a('<div class="vex-dialog-input" />'),c.append(f.append(b.message)).append(e.append(b.input)).append(d.buttonsToDOM(b.buttons)).bind("submit.vex",b.onSubmit),c},d.getFormValueOnSubmit=function(a){return a.vex||""===a.vex?"_vex-empty-value"===a.vex?!0:a.vex:a},d.buttonsToDOM=function(c){var d;return d=a('<div class="vex-dialog-buttons" />'),a.each(c,function(e,f){var g;return g=a('<input type="'+f.type+'" />').val(f.text).addClass(f.className+" vex-dialog-button "+(0===e?"vex-first ":"")+(e===c.length-1?"vex-last ":"")).bind("click.vex",function(c){return f.click?f.click(a(this).parents("."+b.baseClassNames.content),c):void 0}),g.appendTo(d)}),d},d)},"function"==typeof define&&define.amd?define(["jquery","vex"],a):"object"==typeof exports?module.exports=a(require("jquery"),require("vex")):window.vex.dialog=a(window.jQuery,window.vex)}.call(this);